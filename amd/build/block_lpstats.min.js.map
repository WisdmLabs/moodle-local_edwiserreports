{"version":3,"sources":["block_lpstats.js"],"names":["define","$","Chart","cfg","V","init","notifyListner","lpChart","panel","getPanel","panelBody","selectedLp","exportUrlLink","chart","loader","lpStatsBlock","getLpStatsData","lpId","ajax","url","requestUrl","type","requestType","dataType","requestDataType","sesskey","data","action","JSON","stringify","lpid","done","response","responsedata","graph","labels","datasets","backgroundColor","ctx","options","generateLpChart","fail","error","console","log","always","addClass","removeClass","document","ready","val","getLpStatsBlock","select2","on","this","changeExportUrl","filterReplaceFlag","destroy"],"mappings":"AAAA,aAGAA,OAAO,CAAC,SAAU,eAAgB,qCAAsC,iCAAkC,gCAAiC,SAAUC,EAAGC,EAAOC,EAAKC,GAwFlK,MAAO,CACLC,KApFF,SAAcC,GACZ,IAAIC,EAAU,KACVC,EAAQL,EAAIM,SAAS,iBACrBC,EAAYP,EAAIM,SAAS,gBAAiB,QAC1CE,EAAaD,EAAY,uBACzBE,EAAgBJ,EAAQ,oEACxBK,EAAQH,EAAY,aACpBI,EAASJ,EAAY,WACrBK,GAAe,EAyBnB,SAASC,EAAeC,GACtBhB,EAAEiB,KAAK,CACLC,IAAKhB,EAAIiB,WACTC,KAAMlB,EAAImB,YACVC,SAAUpB,EAAIqB,gBACdC,QAASxB,EAAEO,GAAOkB,KAAK,WACvBA,KAAM,CACJC,OAAQ,wBACRF,QAASxB,EAAEO,GAAOkB,KAAK,WACvBA,KAAME,KAAKC,UAAU,CACnBC,KAAMb,OAGTc,KAAK,SAAUC,IAgBpB,SAAyBC,GACvB,GAAIlB,EAAc,CAChBA,EAAamB,MAAMC,OAASF,EAAaE,OACzCpB,EAAamB,MAAMR,KAAOO,EAAaP,KACvC,IAAIA,EAAO,CACTS,OAAQpB,EAAamB,MAAMC,OAC3BC,SAAU,CAAC,CACTV,KAAMX,EAAamB,MAAMR,KACzBW,gBAAiBtB,EAAamB,MAAMG,mBAGxC9B,EAAU,IAAIL,EAAMa,EAAauB,IAAK,CACpCZ,KAAMA,EACNL,KAAMN,EAAamB,MAAMb,KACzBkB,QAASxB,EAAamB,MAAMK,WA7B9BC,CAAgBR,EAASN,QACxBe,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACR5C,EAAEa,GAAQgC,SAAS,UACnB7C,EAAEY,GAAOkC,YAAY,UACrBzC,EAAc,kBA5ClBL,EAAE+C,UAAUC,MAAM,WAChB,IAAIhC,EAAOhB,EAAEU,GAAYuC,OACzBnC,EAAeZ,EAAIgD,oBAGjBnC,EAAeC,GACfhB,EAAES,EAAY,kBAAkB0C,UAChCnD,EAAEU,GAAY0C,GAAG,SAAU,WACzBpC,EAAOhB,EAAEqD,MAAMJ,MACfjD,EAAEY,GAAOiC,SAAS,UAClB7C,EAAEa,GAAQiC,YAAY,UACtB5C,EAAIoD,gBAAgBtC,EAAML,EAAeR,EAAEoD,mBAC3CjD,EAAQkD,UACRzC,EAAeC,MAGjBX,EAAc","sourcesContent":["/* eslint-disable no-console */\r\ndefine([\r\n    'jquery',\r\n    'core/chartjs',\r\n    'local_edwiserreports/defaultconfig',\r\n    'local_edwiserreports/variables',\r\n    'local_edwiserreports/select2'\r\n], function($, Chart, cfg, V) {\r\n    /**\r\n     * Initialize\r\n     * @param {function} notifyListner Callback function\r\n     */\r\n    function init(notifyListner) {\r\n        var lpChart = null;\r\n        var panel = cfg.getPanel(\"#lpstatsblock\");\r\n        var panelBody = cfg.getPanel(\"#lpstatsblock\", \"body\");\r\n        var selectedLp = panelBody + \" #wdm-lpstats-select\";\r\n        var exportUrlLink = panel + \" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\r\n        var chart = panelBody + \" .ct-chart\";\r\n        var loader = panelBody + \" .loader\";\r\n        var lpStatsBlock = false;\r\n\r\n        $(document).ready(function() {\r\n            var lpId = $(selectedLp).val();\r\n            lpStatsBlock = cfg.getLpStatsBlock();\r\n\r\n            if (lpStatsBlock) {\r\n                getLpStatsData(lpId);\r\n                $(panelBody + ' .singleselect').select2();\r\n\r\n                $(selectedLp).on(\"change\", function() {\r\n                    lpId = $(this).val();\r\n                    $(chart).addClass(\"d-none\");\r\n                    $(loader).removeClass(\"d-none\");\r\n                    cfg.changeExportUrl(lpId, exportUrlLink, V.filterReplaceFlag);\r\n                    lpChart.destroy();\r\n                    getLpStatsData(lpId);\r\n                });\r\n            } else {\r\n                notifyListner(\"lpStatsBlock\");\r\n            }\r\n        });\r\n\r\n        /**\r\n         * Get learning plan stats\r\n         * @param {Integer} lpId Learning plan id\r\n         */\r\n        function getLpStatsData(lpId) {\r\n            $.ajax({\r\n                url: cfg.requestUrl,\r\n                type: cfg.requestType,\r\n                dataType: cfg.requestDataType,\r\n                sesskey: $(panel).data(\"sesskey\"),\r\n                data: {\r\n                    action: 'get_lpstats_data_ajax',\r\n                    sesskey: $(panel).data(\"sesskey\"),\r\n                    data: JSON.stringify({\r\n                        lpid: lpId\r\n                    })\r\n                },\r\n            })\r\n                .done(function(response) {\r\n                    generateLpChart(response.data);\r\n                })\r\n                .fail(function(error) {\r\n                    console.log(error);\r\n                })\r\n                .always(function() {\r\n                    $(loader).addClass(\"d-none\");\r\n                    $(chart).removeClass(\"d-none\");\r\n                    notifyListner(\"lpStatsBlock\");\r\n                });\r\n        }\r\n\r\n        /**\r\n         * Generate learning plan chart.\r\n         * @param {Object} responsedata Generate chart response data.\r\n         */\r\n        function generateLpChart(responsedata) {\r\n            if (lpStatsBlock) {\r\n                lpStatsBlock.graph.labels = responsedata.labels;\r\n                lpStatsBlock.graph.data = responsedata.data;\r\n\r\n                var data = {\r\n                    labels: lpStatsBlock.graph.labels,\r\n                    datasets: [{\r\n                        data: lpStatsBlock.graph.data,\r\n                        backgroundColor: lpStatsBlock.graph.backgroundColor,\r\n                    }]\r\n                };\r\n\r\n                lpChart = new Chart(lpStatsBlock.ctx, {\r\n                    data: data,\r\n                    type: lpStatsBlock.graph.type,\r\n                    options: lpStatsBlock.graph.options\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    // Must return the init function\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"file":"block_lpstats.min.js"}