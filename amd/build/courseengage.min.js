define(["jquery","core/modal_factory","core/modal_events","core/fragment","core/templates","local_sitereport/variables","local_sitereport/jquery.dataTables","local_sitereport/dataTables.bootstrap4","local_sitereport/common"],(function(e,a,t,o,r,n){return{init:function(r){var l="#wdm-courseengage-individual",d=l+" .table",s=l+" .loader",i=e(l).data("sesskey"),c=n.requestUrl+"?action=get_courseengage_data_ajax&sesskey="+i,u=null,m=0;function g(a){e(d).show(),e(s).hide(),u=e(d).DataTable({ajax:c+"&cohortid="+a,columns:[{data:"coursename"},{data:"enrolment"},{data:"visited"},{data:"activitystart"},{data:"completedhalf"},{data:"coursecompleted"}],columnDefs:[{className:"text-left",targets:0},{className:"text-center modal-trigger",targets:"_all"}],language:{searchPlaceholder:"Search courses",emptyTable:"There are no courses"},drawCallback:function(){e(".dataTables_paginate > .pagination").addClass("pagination-sm pull-right"),e(".dataTables_filter").addClass("pagination-sm pull-right")},bInfo:!1})}e(document).ready((function(){g(m),e(document).on("click","#cohortfilter ~ .dropdown-menu .dropdown-item",(function(){u&&(u.destroy(),e(d).hide(),e(s).show()),m=e(this).data("cohortid"),n.changeExportUrl(m,".dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item",n.cohortReplaceFlag),e("#cohortfilter").html(e(this).text()),g(m)})),e(document).on("click","#wdm-courseengage-individual .table a.modal-trigger",(function(){var n=e(this).data("action"),l=e(this).data("courseid"),d=e(this).data("coursename"),s=null;a.create({body:o.loadFragment("local_sitereport","userslist",r,{page:"courseengage",courseid:l,action:n,cohortid:m})}).then((function(a){s=a.getRoot(),a.setTitle(d),a.show(),s.on(t.hidden,(function(){a.destroy()})),s.on(t.shown,(function(){e(window).resize()})),s.on(t.bodyRendered,(function(){var e=s.find(".modal-table");e.find("tbody").hasClass("empty")&&e.find("tbody").empty(),s.find(".modal-table").DataTable({language:{searchPlaceholder:"Search users",emptyTable:"There are no users"},scrollY:"350px",scrollX:!0,paging:!1,bInfo:!1})}))}))}))}))}}}));