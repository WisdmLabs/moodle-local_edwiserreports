{"version":3,"sources":["certificates.js"],"names":["define","$","ModalFactory","ModalEvents","Fragment","Templates","V","init","CONTEXTID","PageId","CertTable","find","CertSelect","dataTable","certificateid","cohortId","getCertificateDetail","params","action","sesskey","data","JSON","stringify","cohortid","destroy","DataTable","ajax","generateUrl","requestUrl","columnDefs","targets","className","columns","language","searchPlaceholder","emptyTable","initComplete","settings","json","asPieProgress","show","drawCallback","target","element","addClass","namespace","speed","classes","svg","number","content","bInfo","responsive","document","ready","select2","val","cohortFilterBtn","on","this","changeExportUrl","cohortReplaceFlag","html","text"],"mappings":"AAAA,aAEAA,OAAO,CAAC,SAAU,qBAAsB,oBAAqB,gBAAiB,iBAAkB,iCAAkC,+BAAgC,yCAA0C,6CAA8C,4CAA6C,+BAAgC,SAAUC,EAAGC,EAAcC,EAAaC,EAAUC,EAAWC,GAiIlY,MAAO,CACLC,KA7HF,SAAcC,GAIZ,IAAIC,EAASR,EAAE,gCACXS,EAAYD,EAAOE,KAAK,UACxBC,EAAa,2BAEbC,EAAY,KACZC,EAAgB,KAEhBC,EAAW,EASf,SAASC,EAAqBF,EAAeC,GAC3C,IAAIE,EAAS,CACXC,OAAQ,6BACRC,QAASlB,EAAEQ,GAAQW,KAAK,WACxBA,KAAMC,KAAKC,UAAU,CACnBR,cAAeA,EACfS,SAAUR,KAIVF,GACFA,EAAUW,UAGZX,EAAYH,EAAUe,UAAU,CAC9BC,KAAMpB,EAAEqB,YAAYrB,EAAEsB,WAAYX,GAClCY,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,gBACZ,CACDD,QAAW,EACXC,UAAa,gBACZ,CACDD,QAAW,OACXC,UAAa,6BAEfC,QAAS,CAAC,CACRZ,KAAQ,YACP,CACDA,KAAQ,SACP,CACDA,KAAQ,aACP,CACDA,KAAQ,gBACP,CACDA,KAAQ,SACP,CACDA,KAAQ,mBAEVa,SAAU,CACRC,kBAAmB,cACnBC,WAAY,+BAGdC,aAAc,SAAsBC,EAAUC,GAC5CrC,EAAE,iBAAiBsC,gBACnB7B,EAAU8B,QAEZC,aAAc,WAelB,IAA2BC,EACrBC,EAfA1C,EAAE,sCAAsC2C,SAAS,4BACjD3C,EAAE,sBAAsB2C,SAAS,4BAcjCD,EAAUlC,EAEA,KAHWiC,EAZH,MAgBpBC,EAAUA,EAAQhC,KAAK+B,IAGzBC,EAAQhC,KAAK,iBAAiB4B,cAAc,CAC1CM,UAAW,eACXC,MAAO,GACPC,QAAS,CACPC,IAAK,mBACLL,QAAS,eACTM,OAAQ,sBACRC,QAAS,2BAxBXC,OAAO,EACPC,YAAY,IA4BhBnD,EAAEoD,UAAUC,MAAM,WAGhBrD,EAAEoD,UAAU1C,KAAKC,GAAY2C,UAE7BvC,EADAF,EAAgBb,EAAEW,GAAY4C,OAI9BvD,EAjGqBwD,iDAiGDC,GAAG,QAAS,WAC9B3C,EAAWd,EAAE0D,MAAMvC,KAAK,YACxBd,EAAEsD,gBAAgB7C,EAzGF,mEAyG2BT,EAAEuD,mBAC7C5D,EArGkB,iBAqGC6D,KAAK7D,EAAE0D,MAAMI,QAChC/C,EAAqBF,EAAeC,KAEtCd,EAAEoD,UAAUK,GAAG,SAAU9C,EAAY,WAEnCI,EADAF,EAAgBb,EAAE0D,MAAMH,OAExBvD,EAAE,wCAAwCuD,IAAI1C","sourcesContent":["define([\r\n    'jquery',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/fragment',\r\n    'core/templates',\r\n    'local_edwiserreports/variables',\r\n    'local_edwiserreports/select2',\r\n    'local_edwiserreports/jquery.dataTables',\r\n    'local_edwiserreports/dataTables.bootstrap4',\r\n    'local_edwiserreports/jquery-asPieProgress',\r\n    'local_edwiserreports/common'\r\n], function($, ModalFactory, ModalEvents, Fragment, Templates, V) {\r\n    /**\r\n     * Initialize\r\n     * @param {integer} CONTEXTID Current page context id\r\n     */\r\n    function init(CONTEXTID) {\r\n        // Dirty fix to remove unused vars.\r\n        // eslint-disable-next-line no-unused-vars\r\n        CONTEXTID = null;\r\n        var PageId = $(\"#wdm-certificates-individual\");\r\n        var CertTable = PageId.find(\".table\");\r\n        var CertSelect = \"#wdm-certificates-select\";\r\n        var exportUrlLink = \".dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item\";\r\n        var dataTable = null;\r\n        var certificateid = null;\r\n\r\n        // Varibales for cohort filter\r\n        var cohortId = 0;\r\n        var cohortFilterBtn = \"#cohortfilter\";\r\n        var cohortFilterItem = cohortFilterBtn + \" ~ .dropdown-menu .dropdown-item\";\r\n\r\n        /**\r\n         * Get certificate detail using certificate id and cohort id\r\n         * @param {Integer} certificateid Certificate id\r\n         * @param {Integer} cohortId Cohort id\r\n         */\r\n        function getCertificateDetail(certificateid, cohortId) {\r\n            var params = {\r\n                action: 'get_certificates_data_ajax',\r\n                sesskey: $(PageId).data(\"sesskey\"),\r\n                data: JSON.stringify({\r\n                    certificateid: certificateid,\r\n                    cohortid: cohortId\r\n                })\r\n            };\r\n\r\n            if (dataTable) {\r\n                dataTable.destroy();\r\n            }\r\n\r\n            dataTable = CertTable.DataTable({\r\n                ajax: V.generateUrl(V.requestUrl, params),\r\n                columnDefs: [\r\n                    {\r\n                        \"targets\": 0,\r\n                        \"className\": \"align-middle\"\r\n                    },\r\n                    {\r\n                        \"targets\": 1,\r\n                        \"className\": \"align-middle\"\r\n                    },\r\n                    {\r\n                        \"targets\": \"_all\",\r\n                        \"className\": \"align-middle text-center\"\r\n                    }\r\n                ],\r\n                columns: [\r\n                    {\"data\": \"username\"},\r\n                    {\"data\": \"email\"},\r\n                    {\"data\": \"issuedate\"},\r\n                    {\"data\": \"dateenrolled\"},\r\n                    {\"data\": \"grade\"},\r\n                    {\"data\": \"courseprogress\"}\r\n                ],\r\n                language: {\r\n                    searchPlaceholder: \"Search User\",\r\n                    emptyTable: \"No certificates are awarded\"\r\n                },\r\n                // eslint-disable-next-line no-unused-vars\r\n                initComplete: function(settings, json) {\r\n                    $('.pie-progress').asPieProgress();\r\n                    CertTable.show();\r\n                },\r\n                drawCallback: function() {\r\n                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\r\n                    $('.dataTables_filter').addClass('pagination-sm pull-right');\r\n                    createPieProgress('');\r\n                },\r\n                bInfo: false,\r\n                responsive: true\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Create pie progress where div with .pie-progress class is present\r\n         * @param {String} target Target selector.\r\n         */\r\n        function createPieProgress(target) {\r\n            var element = PageId;\r\n            if (target != '') {\r\n                element = element.find(target);\r\n            }\r\n            element.find('.pie-progress').asPieProgress({\r\n                namespace: 'pie-progress',\r\n                speed: 30,\r\n                classes: {\r\n                    svg: 'pie-progress-svg',\r\n                    element: 'pie-progress',\r\n                    number: 'pie-progress-number',\r\n                    content: 'pie-progress-content'\r\n                }\r\n            });\r\n        }\r\n\r\n        $(document).ready(function() {\r\n            // CertDropdown.remove();\r\n            // $(document).find(CertSelect).show();\r\n            $(document).find(CertSelect).select2();\r\n\r\n            certificateid = $(CertSelect).val();\r\n            getCertificateDetail(certificateid);\r\n\r\n            /* Select cohort filter for active users block */\r\n            $(cohortFilterItem).on('click', function() {\r\n                cohortId = $(this).data('cohortid');\r\n                V.changeExportUrl(cohortId, exportUrlLink, V.cohortReplaceFlag);\r\n                $(cohortFilterBtn).html($(this).text());\r\n                getCertificateDetail(certificateid, cohortId);\r\n            });\r\n\r\n            $(document).on(\"change\", CertSelect, function() {\r\n                certificateid = $(this).val();\r\n                getCertificateDetail(certificateid);\r\n                $('.download-links input[name=\"filter\"]').val(certificateid);\r\n                // V.changeExportUrl(certificateid, exportUrlLink, V.filterReplaceFlag);\r\n            });\r\n        });\r\n    }\r\n\r\n    return {\r\n        init: init\r\n    };\r\n\r\n});\r\n"],"file":"certificates.min.js"}