define(["jquery","core/chartjs","local_sitereport/defaultconfig","local_sitereport/variables","local_sitereport/select2"],(function(e,o,r,a){return{init:function(t){var s=null,l=r.getPanel("#courseprogressblock"),n=r.getPanel("#courseprogressblock","body"),c=(r.getPanel("#courseprogressblock","header"),r.getPanel("#courseprogressblock","footer"),n+" #wdm-courseprogress-select"),d=n+" .ct-chart",i=n+" .loader",g=l+" .dropdown-menu[aria-labelledby='export-dropdown'] .dropdown-item",p=!1,u=e(l+" form.download-links");function f(){var n=e(c).val();r.changeExportUrl(n,g,a.filterReplaceFlag),console.log(u.find('input[name="filter"]')),console.log(u),u.find('input[name="filter"]').val(n),s&&s.destroy(),e.ajax({url:r.requestUrl,type:r.requestType,dataType:r.requestDataType,data:{action:"get_courseprogress_graph_data_ajax",sesskey:e(l).data("sesskey"),data:JSON.stringify({courseid:n})}}).done((function(e){p.graph.data=e.data})).fail((function(e){console.log(e)})).always((function(){var r;r={labels:p.graph.labels,datasets:[{label:p.graph.label,data:p.graph.data,backgroundColor:p.graph.backgroundColor}]},s=new o(p.ctx,{data:r,type:p.graph.type,options:p.graph.options}),e(i).hide(),e(d).fadeIn("slow"),t("courseProgress")}))}e(document).ready((function(e){(p=r.getCourseProgressBlock())?(f(),e(n+" .singleselect").select2(),e(c).on("change",(function(){e(d).hide(),e(i).show(),f()}))):t("courseProgress")}))}}}));