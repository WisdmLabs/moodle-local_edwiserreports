{"version":3,"sources":["customreportsblock.js"],"names":["define","$","ajax","modalFactory","modalEvents","templates","notif","str","cfCheckbox","cfSelect","cfCohort","cfCourse","cfSave","cfSaveForm","crDesktopEnableSwitch","crDeleteBtn","crHideBtn","cpHeader","cfPreviewTable","crListTable","customReportSaveTitle","M","util","get_string","selectedFields","courses","cohorts","reportsId","reportsDataLoaded","reportsData","downloadenable","cfPreviewLoader","selector","show","this","removeClass","addClass","hide","cfPreview","empty","crListLoader","crList","getCustomReportsData","val","each","push","getCustomReportsDataAjax","call","methodname","args","params","JSON","stringify","fields","length","prop","done","response","success","data","parse","console","log","reportsdata","clear","destroy","html","DataTable","columns","bInfo","bFilter","searching","lengthChange","drawCallback","always","saveCustomReportsData","create","title","type","types","SAVE_CANCEL","body","render","modal","root","getRoot","find","on","save","e","preventDefault","serializeArray","reduce","obj","item","name","value","ret","reportname","reportshortname","test","validateCustomReprtsSaveData","querydata","selectedfield","saveCustomReportsDataService","click","addNotification","message","errormsg","animate","scrollTop","getCustomReportsList","language","searchPlaceholder","emptyTable","order","customReportServiceInit","document","enabledesktop","is","reportsid","action","reportId","get_strings","key","component","s","confirm","proxy","currentTarget","checkboxId","attr","toggleClass","trigger","init","ready"],"mappings":"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","sourcesContent":["define([\n    'jquery',\n    'core/ajax',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/templates',\n    'core/notification',\n    'core/str',\n    'local_edwiserreports/jquery.dataTables',\n    'local_edwiserreports/dataTables.bootstrap4'\n], function (\n    $,\n    ajax,\n    modalFactory,\n    modalEvents,\n    templates,\n    notif,\n    str\n) {\n    'use strict';\n\n    // Field group checkbox\n    var cfCheckbox = '.field .custom-field-checkbox';\n    var cfSelect = '.reports-filter-body .custom-field-select';\n    var cfCohort = '#wdm-cohort-select';\n    var cfCourse = '#wdm-course-select';\n    var cfSave = '#wdm-custom-reports-save';\n    var cfSaveForm = '#wdm-customreports-save-form';\n    var crPageId = '#wdm_custom_reports_id';\n    var crPageFullname = '#wdm_custom_reports_fullname';\n    var crPageShortname = '#wdm_custom_reports_shortname';\n    var crPageDownloadEnable = '#wdm_custom_reports_downloadenable';\n    var crPageDesktopEnable = '#wdm_custom_reports_desktopenable';\n    var crDesktopEnableSwitch = '[id^=\"wdm-desktopenable-\"]';\n    var crDeleteBtn = '#cr-list-table a[data-action=\"delete\"]';\n    var crHideBtn = '#cr-list-table a[data-action=\"hide\"]';\n    var cpHeader = '.reports-preview-header .rp-header';\n    var cfPreviewTable = null;\n    var crListTable = null;\n    var customReportSaveTitle = M.util.get_string('savecustomreport', 'local_edwiserreports');\n\n    var selectedFields = [];\n    var courses = [];\n    var cohorts = [];\n    var reportsId = 0;\n    var reportsDataLoaded = true;\n    var reportsData = {\n        downloadenable : true\n    };\n\n    var cfPreviewLoader = {\n        selector : '.reports-preview-body .reports-preview-content.loader',\n\n        show : function() {\n            $(this.selector).removeClass('d-none').addClass('d-flex');\n        },\n\n        hide : function() {\n            $(this.selector).removeClass('d-flex').addClass('d-none');\n        }\n    }\n\n    var cfPreview = {\n        selector : '.reports-preview-body .reports-preview-content',\n\n        show : function() {\n            $(this.selector + ':not(.loader)').removeClass('d-none').addClass('d-flex');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.hide();\n        },\n\n        hide : function() {\n            $(this.selector + ':not(.loader)').removeClass('d-flex').addClass('d-none');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.show();\n        },\n\n        empty : function() {\n            $(this.selector + '.empty').removeClass('d-none').addClass('d-flex');\n            $(this.selector + ':not(.empty)').removeClass('d-flex').addClass('d-none');\n            cfPreviewLoader.hide();\n        }\n    }\n\n    var crListLoader = {\n        selector : '.reports-list-body .reports-list-content.loader',\n\n        show : function() {\n            $(this.selector).removeClass('d-none').addClass('d-flex');\n        },\n\n        hide : function() {\n            $(this.selector).removeClass('d-flex').addClass('d-none');\n        }\n    }\n\n    var crList = {\n        selector : '.reports-list-body .reports-list-content',\n\n        show : function() {\n            $(this.selector + ':not(.loader)').removeClass('d-none').addClass('d-flex');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            crListLoader.hide();\n        },\n\n        hide : function() {\n            $(this.selector + ':not(.loader)').removeClass('d-flex').addClass('d-none');\n            $(this.selector + '.empty').removeClass('d-flex').addClass('d-none');\n            crListLoader.show();\n        },\n\n        empty : function() {\n            $(this.selector + '.empty').removeClass('d-none').addClass('d-flex');\n            $(this.selector + ':not(.empty)').removeClass('d-flex').addClass('d-none');\n            crListLoader.hide();\n        }\n    }\n\n    function getCustomReportsData() {\n        if (reportsDataLoaded) {\n            reportsDataLoaded = false;\n            selectedFields = []\n            cohorts = $(cfCohort).val();\n            courses = $(cfCourse).val();\n            $(cfCheckbox + \":checked\").each(function() {\n                selectedFields.push($(this).val());\n            });\n\n            var getCustomReportsDataAjax = ajax.call([{\n                methodname: 'local_edwiserreports_get_customreports_data',\n                args: {\n                    params: JSON.stringify({\n                        fields : selectedFields,\n                        cohorts : cohorts,\n                        courses : courses\n                    })\n                }\n            }]);\n\n            if (selectedFields.length == 0) {\n                cfPreview.empty();\n                $(cfSave).prop('disabled', true);\n                reportsDataLoaded = true;\n            } else {\n                cfPreview.hide();\n                getCustomReportsDataAjax[0].done(function(response) {\n                    if (response.success) {\n                        var data = JSON.parse(response.data);\n                        console.log(data.reportsdata.length);\n                        if (data.reportsdata.length == 0) {\n                            cfPreview.empty();\n                            $(cfSave).prop('disabled', true);\n                        } else {\n                            if (cfPreviewTable) {\n                                cfPreviewTable.clear().destroy();\n                                $('#cr-preview-table').html('');\n                            }\n                            cfPreview.show();\n                            cfPreviewTable = $('#cr-preview-table').DataTable({\n                                columns: data.columns,\n                                data: data.reportsdata,\n                                bInfo: false,\n                                bFilter: false,\n                                searching: false,\n                                lengthChange: false,\n                                drawCallback: function() {\n                                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\n                                    $('.dataTables_filter').addClass('pagination-sm pull-right');\n                                }\n                            });\n                            $(cfSave).prop('disabled', false);\n                        }\n                    }\n                }).always(function () {\n                    reportsDataLoaded = true;\n                });\n            }\n        }\n    }\n\n    function validateCustomReprtsSaveData(data) {\n        var ret = true;\n        if (data.reportname == '') {\n            $('#id_error_crb_reportname')\n                .html(M.util.get_string('emptyfullname', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n\n        if (data.reportshortname == '') {\n            $('#id_error_crb_reportshortname')\n                .html(M.util.get_string('emptyshortname', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n\n        var format = /[ `!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?~]/;\n        if (format.test(data.reportshortname)) {\n            $('#id_error_crb_reportshortname')\n                .html(M.util.get_string('nospecialchar', 'local_edwiserreports'))\n                .show();\n            ret = false;\n        }\n        return ret;\n    }\n\n    function saveCustomReportsData() {\n        modalFactory.create({\n            title: customReportSaveTitle,\n            type: modalFactory.types.SAVE_CANCEL,\n            body: templates.render('local_edwiserreports/custom_reports_save_form', reportsData)\n        }).done(function(modal) {\n            var root = modal.getRoot();\n            root.find('.modal-dialog').addClass('modal-lg');\n            modal.show();\n            root.on(modalEvents.save, function(e) {\n                // Stop the default save button behaviour which is to close the modal.\n                e.preventDefault();\n\n                // Remove all error on type\n                root.find('input').on('input', function() {\n                    $('[id^=\"id_error_crb\"]').html('');\n                });\n\n                var data = $(cfSaveForm).serializeArray().reduce(function(obj, item) {\n                    obj[item.name] = item.value;\n                    return obj;\n                }, {});\n\n                if (validateCustomReprtsSaveData(data)) {\n                    // Prepare query data\n                    data.querydata = {\n                        'selectedfield': selectedFields,\n                        'cohorts': cohorts,\n                        'courses': courses\n                    }\n\n                    saveCustomReportsDataService(data, modal);\n                }\n            });\n        });\n    }\n\n    function saveCustomReportsDataService(data, modal) {\n        var saveCustomReportsData = ajax.call([{\n            methodname: 'local_edwiserreports_save_customreports_data',\n            args: {\n                params: JSON.stringify(data)\n            }\n        }]);\n\n        saveCustomReportsData[0].done(function(response) {\n            if (response.success) {\n                if (modal) {\n                    reportsData = JSON.parse(response.reportsdata);\n                    $(cpHeader).html(reportsData.reportname);\n                    $(cfSave).html(M.util.get_string('updatereports', 'local_edwiserreports'));\n                }\n                $('#user-notifications .close').click();\n                notif.addNotification({\n                    message: M.util.get_string('reportssavesuccess', 'local_edwiserreports'),\n                    type: \"success\"\n                });\n            } else {\n                $('#user-notifications .close').click();\n                notif.addNotification({\n                    message: response.errormsg,\n                    type: \"error\"\n                });\n            }\n            if (modal) {\n                $(\"html, body\").animate({ scrollTop: 0 }, \"slow\");\n                getCustomReportsList();\n                modal.destroy();\n            }\n        });\n    }\n\n    function getCustomReportsList() {\n        var getCustomReportsList = ajax.call([{\n            methodname: 'local_edwiserreports_get_customreports_list',\n            args: {\n                params: JSON.stringify({})\n            }\n        }]);\n        getCustomReportsList[0].done(function(response) {\n            var data = JSON.parse(response.data);\n            if (response.success) {\n                if (data.length == 0) {\n                    crList.empty();\n                } else {\n                    if (crListTable) {\n                        crListTable.clear().destroy();\n                        $('#cr-list-table').html('');\n                    }\n\n                    crListTable = $('#cr-list-table').DataTable({\n                        columns: [\n                            {\n                                data: 'fullname',\n                                title: M.util.get_string('title', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'createdby',\n                                title: M.util.get_string('createdby', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'datecreated',\n                                title: M.util.get_string('datecreated', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'datemodified',\n                                title: M.util.get_string('datemodified', 'local_edwiserreports')\n                            },\n                            {\n                                data: 'managehtml',\n                                title: M.util.get_string('manage', 'local_edwiserreports')\n                            }\n                        ],\n                        language: { \n                            searchPlaceholder: M.util.get_string('searchreports', 'local_edwiserreports'),\n                            emptyTable: M.util.get_string('noresult', 'local_edwiserreports')\n                        },\n                        order: [[0, 'asc']],\n                        data: data,\n                        bInfo: false,\n                        lengthChange: false,\n                        drawCallback: function() {\n                            $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\n                            $('.dataTables_filter').addClass('pagination-sm pull-right');\n                        }\n                    });\n                    crList.show();\n                }\n            }\n        });\n    }\n\n    function customReportDelete(reportsId) {\n        var deleteCustomReport = ajax.call([{\n            methodname: 'local_edwiserreports_delete_custom_report',\n            args: {\n                params: JSON.stringify({reportsid: reportsId})\n            }\n        }]);\n        deleteCustomReport[0].done(function(response) {\n            if (response.success) {\n                notif.addNotification({\n                    message: response.message,\n                    type: \"success\"\n                });\n            } else {\n                notif.addNotification({\n                    message: response.message,\n                    type: \"error\"\n                });\n            }\n        }).always(function() {\n            $(\"html, body\").animate({ scrollTop: 0 }, \"slow\");\n            getCustomReportsList();\n        })\n    }\n\n    function customReportServiceInit() {\n        $(cfCheckbox).on('change', function () {\n            getCustomReportsData();\n        });\n        $(cfSelect).on('change', function () {\n            getCustomReportsData();\n        });\n        $(cfSave).on('click', function () {\n            saveCustomReportsData();\n        });\n        getCustomReportsList();\n        $(document).on('change', crDesktopEnableSwitch, function () {\n            var enabledesktop = false;\n            if ($(this).is(\":checked\")) {\n                enabledesktop = true;\n            }\n            var updateData = {\n                reportsid: $(this).data('reportsid'),\n                enabledesktop: enabledesktop,\n                action: 'enabledesktop'\n            }\n\n            saveCustomReportsDataService(updateData, false);\n        });\n        $(document).on('click', crDeleteBtn, function (e) {\n            e.preventDefault();\n\n            var reportId = $(this).data('reportsid');\n            str.get_strings([\n                {\n                    key: 'deletecustomreportstitle',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'deletecustomreportsquestion',\n                    component: 'local_edwiserreports'\n                },\n                {\n                    key: 'yes',\n                    component: 'moodle'\n                },\n                {\n                    key: 'no',\n                    component: 'moodle'\n                }\n            ]).done(function(s) {\n                notif.confirm(s[0], s[1], s[2], s[3], $.proxy(function() {\n                    customReportDelete(reportId);\n                }, e.currentTarget));\n            });\n        });\n        $(document).on('click', crHideBtn, function (e) {\n            e.preventDefault();\n\n            var checkboxId = $(this).data('target');\n            if ($(this).data('value')) {\n                $(this).attr('title', $(this).data('titlehide'));\n                $(this).attr('data-original-title', $(this).data('titlehide'));\n                $(this).data('value', 0)\n            } else {\n                $(this).attr('title', $(this).data('titleshow'));\n                $(this).attr('data-original-title', $(this).data('titleshow'));\n                $(this).data('value', 1)\n            }\n            $(this).find('.icon').toggleClass('fa-eye');\n            $(this).find('.icon').toggleClass('fa-eye-slash');\n            $(checkboxId).trigger('click');\n        });\n    }\n\n    return {\n        init : function () {\n            $(document).ready(function () {\n                customReportServiceInit();\n                if (reportsId = $(crPageId).val()) {\n                    reportsData.reportsid = reportsId;\n                    reportsData.reportname = $(crPageFullname).val();\n                    reportsData.reportshortname = $(crPageShortname).val();\n\n                    if ($(crPageDownloadEnable).val() != 0) {\n                        reportsData.downloadenable = true;\n                    } else {\n                        reportsData.downloadenable = false;\n                    }\n\n                    if ($(crPageDesktopEnable).val() != 0) {\n                        reportsData.enabledesktop = true;\n                    } else {\n                        reportsData.enabledesktop = false;\n                    }\n\n                    getCustomReportsData();\n                }\n            });\n        }\n    }\n});\n"],"file":"customreportsblock.min.js"}