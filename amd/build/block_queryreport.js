define(["jquery","report_elucidsitereport/defaultconfig","core/templates","report_elucidsitereport/select2"],(function(e,t,n){e(document).ready((function(){e("#ed_rpm").select2({multiple:!0}),e("#ed_lps").select2({multiple:!0}),e("#ed_courses").select2({multiple:!0}),e("#ed_lps").on("change",(function(o){e("div[class^='lp']").show();var s=[];if(e(o.currentTarget).find("option:selected").each((function(t,n){s[t]=e(n).val()})),s.length>1){var c=s.indexOf("0");c>-1&&(s.splice(c,1),o.preventDefault(),e("#ed_lps").select2("val",s))}e.ajax({url:t.requestUrl,type:t.requestType,dataType:t.requestDataType,data:{action:"get_customqueryreport_data_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({lpids:s})}}).done((function(t){e("#ed_courses").html("");var o={courses:t};n.render("report_elucidsitereport/customquery_options",o).then((function(t,o){n.replaceNodeContents(e("#ed_courses"),t,o)}))})).fail((function(e){})),s.length||e("div[class^='lp']").hide()})),e("#ed_rpm").on("change",(function(o){e("div[class^='rpm']").show();var s=[];if(e(o.currentTarget).find("option:selected").each((function(t,n){s[t]=e(n).val()})),s.length>1){var c=s.indexOf("0");c>-1&&(s.splice(c,1),e("#ed_rpm").select2("val",s))}e.ajax({url:t.requestUrl,type:t.requestType,dataType:t.requestDataType,data:{action:"get_customqueryreport_rpm_data_ajax",sesskey:M.cfg.sesskey,data:JSON.stringify({rpmids:s})}}).done((function(t){e("#ed_lps").html(""),e("#ed_courses").html("");var o="report_elucidsitereport/customquery_lpoptions",s={lps:t.lps};if(t.lps.length>0&&n.render(o,s).then((function(t,o){n.appendNodeContents(e("#ed_lps"),t,o)})),t.courses.length>0){o="report_elucidsitereport/customquery_options",s={courses:t.courses};n.render(o,s).then((function(t,o){n.appendNodeContents(e("#ed_courses"),t,o)}))}})).fail((function(e){console.log(e)})),s.length||(e("div[class^='rpm']").hide(),e("div[class^='lp']").hide())})),e("#ed_courses").on("change",(function(t){var n=[];if(e(t.currentTarget).find("option:selected").each((function(t,o){n[t]=e(o).val()})),n.length>1){var o=n.indexOf("0");o>-1&&(n.splice(o,1),e("#ed_courses").select2("val",n))}}));var o=t.getPanel("#customQueryReportBlock");let s=e(o).find("#customQueryReportsForm");const c=function(t,n,s,c){e(o).find(t).flatpickr({mode:n,altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:c,defaultDate:s,onClose:l,onReady:l})},l=function(t,n,o){const c=t[0].getTime()/1e3;switch(!0){case e(o.element).is("#customqueryenrollstart"):s.find("input[name=enrolstartdate]").val(c);break;case e(o.element).is("#customqueryenrollend"):s.find("input[name=enrolenddate]").val(c);break;case e(o.element).is("#customquerycompletionstart"):s.find("input[name=completionstartdate]").val(c);break;case e(o.element).is("#customquerycompletionend"):s.find("input[name=completionenddate]").val(c)}};function i(t){const n=jQuery("#ed_courses > option:selected").length,c=s.serializeArray(),l={};var i;e.each(c,(function(e,t){l[t.name]=t.value})),n<1?(e(".coursealert").show(),setTimeout((function(){e(".coursealert").hide()}),3e3),t.preventDefault()):l.enrolstartdate>l.enrolenddate||""==l.enrolstartdate&&""!==l.enrolenddate||""!==l.enrolstartdate&&""==l.enrolenddate?(e(".enroldatealert").show(),setTimeout((function(){e(".enroldatealert").hide()}),3e3),t.preventDefault()):l.completionstartdate>l.completionenddate||""==l.completionstartdate&&""!==l.completionenddate||""!==l.completionstartdate&&""==l.completionenddate?(e(".completiondatealert").show(),setTimeout((function(){e(".completiondatealert").hide()}),3e3),t.preventDefault()):(i=[],e(o).find("input[type=checkbox]:checked").each((function(e,t){i.push(t.id)})),s.find("input[name=reporttype]").val("queryReport"),s.find("input[name=checkedFields]").val(i),function(){var t,n,c;t=e(o).find("#ed_rpm").val(),s.find("input[name=reportingmanagers]").val(t),n=e(o).find("#ed_lps").val(),s.find("input[name=lps]").val(n),c=e(o).find("#ed_courses").val(),s.find("input[name=courses]").val(c)}())}c("#customqueryenrollstart, #customquerycompletionstart","single",(new Date).setDate((new Date).getDate()-90),"today"),c("#customqueryenrollend, #customquerycompletionend","single","today","today"),e(document).on("click","#customqueryenrollstart ~ button.input-search-close",(function(){e("#customqueryenrollstart ~ input.form-control").val(""),s.find("input[name=enrolstartdate]").val("")})),e(document).on("click","#customqueryenrollend ~ button.input-search-close",(function(){e("#customqueryenrollend ~ input.form-control").val(""),s.find("input[name=enrolenddate]").val("")})),e(document).on("click","#customquerycompletionstart ~ button.input-search-close",(function(){e("#customquerycompletionstart ~ input.form-control").val(""),s.find("input[name=completionenddate]").val("")})),e(document).on("click","#customquerycompletionend ~ button.input-search-close",(function(){e("#customquerycompletionend ~ input.form-control").val(""),s.find("input[name=completionstartdate]").val("")})),e("#customQueryReportDownload").click((function(e){i(e)})),e("[data-hide]").on("click",(function(){e(this).closest("."+e(this).attr("data-hide")).hide()})),e('.reportfields a[class^="unselect-"]').on("click",(function(){e(this).closest(".reportfields").find('input[type="checkbox"]:not(:disabled)').prop("checked",!1),e(this).hide().siblings('a[class^="select-"]').show()})),e('.reportfields a[class^="select-"]').on("click",(function(){e(this).closest(".reportfields").find('input[type="checkbox"]:not(:disabled)').prop("checked",!0),e(this).hide().siblings('a[class^="unselect-"]').show()})),e(o).find(".checkbox-custom").on("click",(function(){e(this).closest(".reportfields").find('input[type="checkbox"]').length==e(this).closest(".reportfields").find('input[type="checkbox"]:checked').length?e(this).closest(".reportfields").find('a[class^="select-"]').hide().siblings('a[class^="unselect-"]').show():e(this).closest(".reportfields").find('a[class^="unselect-"]').hide().siblings('a[class^="select-"]').show()}))}))}));