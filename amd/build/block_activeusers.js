define(["jquery","core/chartjs","report_elucidsitereport/defaultconfig","report_elucidsitereport/variables","report_elucidsitereport/flatpickr"],function(t,l,n,s){var d=n.activeUsersBlock,i=n.getPanel("#activeusersblock"),e=n.getPanel("#activeusersblock","body"),p=n.getPanel("#activeusersblock","title"),c=(n.getPanel("#activeusersblock","footer"),i+" .dropdown-menu[aria-labelledby='filter-dropdown']"),u=c+" .dropdown-item",g=i+" #filter-dropdown.dropdown-toggle",h=i+" #flatpickrCalender",m=e+" .ct-chart",f=e+" .loader",C=i+" button#filter-dropdown",b=p+" .refresh",v=i+s.exportUrlLink,k=null,y=p+" input.form-control.input",w=null;return{init:function(e){function o(e){t(m).addClass("d-none"),t(f).removeClass("d-none"),t.ajax({url:n.requestUrl,data:{action:"get_activeusers_graph_data_ajax",sesskey:t(i).data("sesskey"),data:JSON.stringify({filter:e})}}).done(function(e){d.graph.data=e.data,d.graph.labels=e.labels}).fail(function(e){console.log(e)}).always(function(){a=function(){a&&a.destroy();return l.defaults.global.defaultFontFamily=d.graph.fontFamily,l.defaults.global.defaultFontStyle=d.graph.fontStyle,a=new l(d.ctx,{type:d.graph.type,data:function(){return{labels:d.graph.labels,datasets:[{label:d.graph.labelName.activeUsers,data:d.graph.data.activeUsers,backgroundColor:d.graph.backgroundColor.activeUsers,borderColor:d.graph.borderColor.activeUsers,pointBorderColor:d.graph.borderColor.activeUsers,pointBackgroundColor:d.graph.borderColor.activeUsers,pointStyle:d.graph.pointStyle},{label:d.graph.labelName.enrolments,data:d.graph.data.enrolments,backgroundColor:d.graph.backgroundColor.enrolments,borderColor:d.graph.borderColor.enrolments,pointBorderColor:d.graph.borderColor.enrolments,pointBackgroundColor:d.graph.borderColor.enrolments,pointStyle:d.graph.pointStyle},{label:d.graph.labelName.completionRate,data:d.graph.data.completionRate,backgroundColor:d.graph.backgroundColor.completionRate,borderColor:d.graph.borderColor.completionRate,pointBorderColor:d.graph.borderColor.completionRate,pointBackgroundColor:d.graph.borderColor.completionRate,pointStyle:d.graph.pointStyle}]}}(),options:d.graph.options})}(),s.changeExportUrl(e,v,s.filterReplaceFlag),t(p+" #updated-time > span.minute").html(0),setInterval(r,6e4),t(b).removeClass("refresh-spin"),t(f).addClass("d-none"),t(m).removeClass("d-none"),w("activeUsers")})}function r(){t(p+" #updated-time > span.minute").html(parseInt(t(p+" #updated-time > span.minute").text())+1)}w=e,t(document).ready(function(){t(g).on("click",function(){t(c).addClass("show")}),t(y).ready(function(){var e=t(y).attr("placeholder");t(y).val(e)}),t(document).click(function(e){t(e.target).hasClass("dropdown-menu")||t(e.target).parents(".dropdown-menu").length||t(c).removeClass("show")}),t(u+":not(.custom)").on("click",function(){k=t(this).attr("value"),t(c).removeClass("show"),t(C).html(t(this).text()),o(k),t(h).val("Custom"),t(y).val("Custom")}),t(b).on("click",function(){t(this).addClass("refresh-spin"),o(k)}),t(h).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:document.getElementById("activeUser-calendar"),onOpen:function(e){t(c).addClass("withcalendar")},onClose:function(){t(c).removeClass("withcalendar"),t(c).removeClass("show"),function(){k=t(h).val();var e=t(y).val();k.includes("to")&&(n.changeExportUrl(k,v,s.filterReplaceFlag),t(C).html(e),t(h).val(""),o(k))}()}})});var a=o()}}});