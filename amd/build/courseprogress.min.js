define(["jquery","core/modal_factory","core/modal_events","core/fragment","core/templates","local_sitereport/variables","local_sitereport/jquery.dataTables","local_sitereport/dataTables.bootstrap4","local_sitereport/common"],(function(e,o,a,t,r,s){return{init:function(l){var n="#wdm-courseprogress-individual",i=n+" .table",c=n+" .loader",d=null,u=0,h=null;function f(o){h=e(n).data("sesskey"),e.ajax({url:s.requestUrl,data:{action:"get_courseprogress_graph_data_ajax",sesskey:h,data:JSON.stringify({courseid:"all",cohortid:o})}}).done((function(o){var a={courseprogress:o,sesskey:h};r.render("local_sitereport/courseprogress",a).then((function(o,a){r.replaceNode(n,o,a),d=e(i).DataTable({dom:'<"pull-left"f><t><p>',order:[[0,"desc"]],bLengthChange:!1,initComplete:function(){e("#wdm-courseprogress-individual .dataTables_wrapper .row:first-child > div:first-child .dropdown").show()},columnDefs:[{targets:0,className:"text-left"},{targets:"_all",className:"text-center"}],language:{searchPlaceholder:"Search courses",emptyTable:"There are no courses"},scrollY:350,scrollX:!0,paginate:!1,sScrollX:"100%",bScrollCollapse:!0}),e(i).show(),e(c).hide()})).fail((function(e){console.log(e)})).always((function(){e(window).resize()}))})).fail((function(e){console.log(e)}))}e(document).ready((function(){f(u),e(document).on("click","#cohortfilter ~ .dropdown-menu .dropdown-item",(function(){d&&(d.destroy(),e(i).hide(),e(c).show()),u=e(this).data("cohortid"),e("#cohortfilter").html(e(this).text()),f(u)})),e(document).on("click","#wdm-courseprogress-individual .table a.modal-trigger",(function(){var r=e(this).data("minvalue"),s=e(this).data("maxvalue"),n=e(this).data("courseid"),i=e(this).data("coursename"),c=null;o.create({body:t.loadFragment("local_sitereport","userslist",l,{page:"courseprogress",courseid:n,minval:r,maxval:s,cohortid:u})}).then((function(e){c=e.getRoot(),e.setTitle(i),e.show(),c.on(a.hidden,(function(){e.destroy()})),c.on(a.bodyRendered,(function(){var e=c.find(".modal-table");e.find("tbody").hasClass("empty")&&e.find("tbody").empty(),c.find(".modal-table").DataTable({language:{searchPlaceholder:"Search users",emptyTable:"There are no users"},scrollY:"350px",scrollX:!0,paging:!1,bInfo:!1})}))}))}))}))}}}));