{"version":3,"sources":["courseprogress.js"],"names":["define","$","ModalFactory","ModalEvents","Fragment","Templates","V","init","CONTEXTID","PageId","CourseProgressTable","loader","ModalTrigger","datatable","cohortId","sesskey","data","url","requestUrl","generateCourseProgressTable","show","hide","JSON","stringify","courseid","cohortid","DataTable","ajax","columns","columnDefs","className","targets","language","searchPlaceholder","emptyTable","drawCallback","addClass","bInfo","document","ready","on","cohortFilterBtn","destroy","this","find","val","html","text","minval","maxval","coursename","ModalRoot","create","body","loadFragment","page","then","modal","getRoot","setTitle","hidden","bodyRendered","ModalTable","hasClass","empty","lengthChange"],"mappings":"AAAA,aAEAA,OAAO,CAAC,SAAU,qBAAsB,oBAAqB,gBAAiB,iBAAkB,iCAAkC,yCAA0C,6CAA8C,+BAAgC,SAAUC,EAAGC,EAAcC,EAAaC,EAAUC,EAAWC,GAoIrT,MAAO,CACLC,KAhIF,SAAcC,GACZ,IAAIC,EAAS,iCACTC,EAAsBD,EAAS,UAC/BE,EAASF,EAAS,WAClBG,EAAeF,EAAsB,mBACrCG,EAAY,KAIZC,EAAW,EACXC,EAAUd,EAAEQ,GAAQO,KAAK,WACzBC,EAAMX,EAAEY,WAAa,sDAAwDH,EAsEjF,SAASI,EAA4BL,GACnCb,EAAES,GAAqBU,OACvBnB,EAAEU,GAAQU,OACV,IAAIL,EAAOM,KAAKC,UAAU,CACxBC,SAAU,MACVC,SAAUX,IAEZD,EAAYZ,EAAES,GAAqBgB,UAAU,CAC3CC,KAAMV,EAAM,aAAeH,EAAW,SAAWE,EACjDY,QAAS,CAAC,CACRZ,KAAQ,cACP,CACDA,KAAQ,cACP,CACDA,KAAQ,gBACP,CACDA,KAAQ,eACP,CACDA,KAAQ,eACP,CACDA,KAAQ,eACP,CACDA,KAAQ,eACP,CACDA,KAAQ,gBAEVa,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,4BACXC,QAAS,SAEXC,SAAU,CACRC,kBAAmB,gBACnBC,WAAY,wBAEdC,aAAc,WACZlC,EAAE,sCAAsCmC,SAAS,4BACjDnC,EAAE,sBAAsBmC,SAAS,6BAEnCC,OAAO,IA9GXpC,EAAEqC,UAAUC,MAAM,WAChBpB,EAA4BL,GAG5Bb,EAAEqC,UAAUE,GAAG,QARMC,gDAQqB,WACpC5B,IACFA,EAAU6B,UACVzC,EAAES,GAAqBW,OACvBpB,EAAEU,GAAQS,QAGZN,EAAWb,EAAE0C,MAAM3B,KAAK,YACxBf,EAAE,aAAa2C,KAAK,0CAA0CC,IAAI/B,GAClEb,EAlBkB,iBAkBC6C,KAAK7C,EAAE0C,MAAMI,QAChC5B,EAA4BL,KAE9Bb,EAAEqC,UAAUE,GAAG,QAAS5B,EAAc,WACpC,IAAIoC,EAAS/C,EAAE0C,MAAM3B,KAAK,YACtBiC,EAAShD,EAAE0C,MAAM3B,KAAK,YACtBQ,EAAWvB,EAAE0C,MAAM3B,KAAK,YACxBkC,EAAajD,EAAE0C,MAAM3B,KAAK,cAC1BmC,EAAY,KAEhBjD,EAAakD,OAAO,CAClBC,KAAMjD,EAASkD,aAAa,uBAAwB,YAAa9C,EAAW,CAC1E+C,KAAM,iBACN/B,SAAUA,EACVwB,OAAQA,EACRC,OAAQA,EACRxB,SAAUX,MAEX0C,KAAK,SAAUC,IAChBN,EAAYM,EAAMC,WACRd,KAAK,iBAAiBR,SAAS,YACzCqB,EAAME,SAAST,GACfO,EAAMrC,OACN+B,EAAUX,GAAGrC,EAAYyD,OAAQ,WAC/BH,EAAMf,YAERS,EAAUX,GAAGrC,EAAY0D,aAAc,WACrC,IAAIC,EAAaX,EAAUP,KAAK,gBAE5BkB,EAAWlB,KAAK,SAASmB,SAAS,UACpCD,EAAWlB,KAAK,SAASoB,QAI3Bb,EAAUP,KAAK,gBAAgBlB,UAAU,CACvCM,SAAU,CACRC,kBAAmB,cACnBC,WAAY,sBAEdC,aAAc,WACZlC,EAAE,sCAAsCmC,SAAS,4BACjDnC,EAAE,sBAAsBmC,SAAS,6BAEnC6B,cAAc,EACd5B,OAAO","sourcesContent":["define([\r\n    'jquery',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/fragment',\r\n    'core/templates',\r\n    'local_edwiserreports/variables',\r\n    'local_edwiserreports/jquery.dataTables',\r\n    'local_edwiserreports/dataTables.bootstrap4',\r\n    'local_edwiserreports/common'\r\n], function($, ModalFactory, ModalEvents, Fragment, Templates, V) {\r\n    /**\r\n     * Initialize\r\n     * @param {integer} CONTEXTID Current page context id\r\n     */\r\n    function init(CONTEXTID) {\r\n        var PageId = \"#wdm-courseprogress-individual\";\r\n        var CourseProgressTable = PageId + \" .table\";\r\n        var loader = PageId + \" .loader\";\r\n        var ModalTrigger = CourseProgressTable + \" a.modal-trigger\";\r\n        var datatable = null;\r\n\r\n        // Varibales for cohort filter\r\n        var cohortFilterBtn = \"#cohortfilter\";\r\n        var cohortFilterItem = cohortFilterBtn + \" ~ .dropdown-menu .dropdown-item\";\r\n        var cohortId = 0;\r\n        var sesskey = $(PageId).data(\"sesskey\");\r\n        var url = V.requestUrl + '?action=get_courseprogress_graph_data_ajax&sesskey=' + sesskey;\r\n\r\n        $(document).ready(function() {\r\n            generateCourseProgressTable(cohortId);\r\n\r\n            /* Select cohort filter for active users block */\r\n            $(document).on('click', cohortFilterItem, function() {\r\n                if (datatable) {\r\n                    datatable.destroy();\r\n                    $(CourseProgressTable).hide();\r\n                    $(loader).show();\r\n                }\r\n                cohortId = $(this).data('cohortid');\r\n                $(\"#progress\").find('.download-links input[name=\"cohortid\"]').val(cohortId);\r\n                $(cohortFilterBtn).html($(this).text());\r\n                generateCourseProgressTable(cohortId);\r\n            });\r\n\r\n            $(document).on('click', ModalTrigger, function() {\r\n                var minval = $(this).data(\"minvalue\");\r\n                var maxval = $(this).data(\"maxvalue\");\r\n                var courseid = $(this).data(\"courseid\");\r\n                var coursename = $(this).data(\"coursename\");\r\n                var ModalRoot = null;\r\n\r\n                // eslint-disable-next-line promise/catch-or-return\r\n                ModalFactory.create({\r\n                    body: Fragment.loadFragment(\r\n                        'local_edwiserreports',\r\n                        'userslist',\r\n                        CONTEXTID,\r\n                        {\r\n                            page: 'courseprogress',\r\n                            courseid: courseid,\r\n                            minval: minval,\r\n                            maxval: maxval,\r\n                            cohortid: cohortId\r\n                        }\r\n                    )\r\n                }).then(function(modal) {\r\n                    ModalRoot = modal.getRoot();\r\n                    ModalRoot.find('.modal-dialog').addClass('modal-lg');\r\n                    modal.setTitle(coursename);\r\n                    modal.show();\r\n                    ModalRoot.on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n\r\n                    ModalRoot.on(ModalEvents.bodyRendered, function() {\r\n                        var ModalTable = ModalRoot.find(\".modal-table\");\r\n\r\n                        // If empty then remove colspan\r\n                        if (ModalTable.find(\"tbody\").hasClass(\"empty\")) {\r\n                            ModalTable.find(\"tbody\").empty();\r\n                        }\r\n\r\n                        // Create dataTable for userslist\r\n                        ModalRoot.find(\".modal-table\").DataTable({\r\n                            language: {\r\n                                searchPlaceholder: \"Search User\",\r\n                                emptyTable: \"There are no users\"\r\n                            },\r\n                            drawCallback: function() {\r\n                                $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\r\n                                $('.dataTables_filter').addClass('pagination-sm pull-right');\r\n                            },\r\n                            lengthChange: false,\r\n                            bInfo: false\r\n                        });\r\n                    });\r\n                    return;\r\n                });\r\n            });\r\n        });\r\n\r\n        /**\r\n         * Generate course progress table\r\n         * @param {Number} cohortId Cohort id\r\n         */\r\n        function generateCourseProgressTable(cohortId) {\r\n            $(CourseProgressTable).show();\r\n            $(loader).hide();\r\n\r\n            var data = JSON.stringify({\r\n                courseid: \"all\",\r\n                cohortid: cohortId\r\n            });\r\n\r\n            datatable = $(CourseProgressTable).DataTable({\r\n                ajax: url + \"&cohortid=\" + cohortId + \"&data=\" + data,\r\n                columns: [\r\n                    {\"data\": \"coursename\"},\r\n                    {\"data\": \"enrolments\"},\r\n                    {\"data\": \"completed100\"},\r\n                    {\"data\": \"completed80\"},\r\n                    {\"data\": \"completed60\"},\r\n                    {\"data\": \"completed40\"},\r\n                    {\"data\": \"completed20\"},\r\n                    {\"data\": \"completed00\"}\r\n                ],\r\n                columnDefs: [\r\n                    {className: \"text-left\", targets: 0},\r\n                    {className: \"text-center modal-trigger\", targets: \"_all\"}\r\n                ],\r\n                language: {\r\n                    searchPlaceholder: \"Search Course\",\r\n                    emptyTable: \"There are no courses\"\r\n                },\r\n                drawCallback: function() {\r\n                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\r\n                    $('.dataTables_filter').addClass('pagination-sm pull-right');\r\n                },\r\n                bInfo: false\r\n            });\r\n        }\r\n    }\r\n\r\n    return {\r\n        init: init\r\n    };\r\n\r\n});\r\n"],"file":"courseprogress.min.js"}