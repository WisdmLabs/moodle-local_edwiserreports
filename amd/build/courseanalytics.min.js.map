{"version":3,"sources":["courseanalytics.js"],"names":["define","$","V","init","CONTEXTID","PageId","RecentVisits","find","RecentEnroled","RecentCompletion","loader","RecentVisitsTable","RecentEnroledTable","RecentCompletionTable","cohortId","getCourseAnalyticsData","courseId","sesskey","data","ajax","url","requestUrl","type","requestType","dataType","requestDataType","action","JSON","stringify","courseid","cohortid","done","response","generateDataTable","recentvisits","recentenrolments","recentcompletions","fail","error","console","log","always","window","resize","fadeIn","tableId","table","emptyStr","destroy","hide","DataTable","responsive","oLanguage","sEmptyTable","sSearchPlaceholder","columnDefs","className","targets","drawCallback","addClass","order","bInfo","lengthChange","document","ready","getUrlParameter","cohortFilterBtn","on","this","html","text"],"mappings":"AAAA,aAGAA,OAAO,CAAC,SAAU,iCAAkC,yCAA0C,6CAA8C,+BAAgC,SAAUC,EAAGC,GAyHvL,MAAO,CACLC,KArHF,SAAcC,GAGZ,IAAIC,EAASJ,EAAE,mCACXK,EAAeD,EAAOE,KAAK,yBAC3BC,EAAgBH,EAAOE,KAAK,4BAC5BE,EAAmBJ,EAAOE,KAAK,6BAC/BG,EAAST,EAAE,WACXU,EAAoB,KACpBC,EAAqB,KACrBC,EAAwB,KAExBC,EAAW,EAqBf,SAASC,EAAuBC,EAAUF,GACxC,IAAIG,EAAUZ,EAAOa,KAAK,WAC1BjB,EAAEkB,KAAK,CACLC,IAAKlB,EAAEmB,WACPC,KAAMpB,EAAEqB,YACRC,SAAUtB,EAAEuB,gBACZP,KAAM,CACJQ,OAAQ,gCACRT,QAASA,EACTC,KAAMS,KAAKC,UAAU,CACnBC,SAAUb,EACVc,SAAUhB,OAGbiB,KAAK,SAAUC,GAEhBrB,EAAoBsB,EAAkB3B,EAAcK,EAAmBqB,EAASd,KAAKgB,cAGrFtB,EAAqBqB,EAAkBzB,EAAeI,EAAoBoB,EAASd,KAAKiB,kBAGxFtB,EAAwBoB,EAAkBxB,EAAkBI,EAAuBmB,EAASd,KAAKkB,qBAChGC,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACRxC,EAAEyC,QAAQC,SACVtC,EAAOuC,OAAO,UAYlB,SAASX,EAAkBY,EAASC,EAAO5B,GACzC,IAAI6B,EAAW,uCAuCf,OApCIF,GAAWpC,EACbsC,EAAW,qCACFF,GAAWvC,IACpByC,EAAW,oCAGC,OAAVD,GACFA,EAAME,UAGRtC,EAAOuC,OACPJ,EAAQD,OAAO,QACfvC,EAAOuC,OAAO,QACdE,EAAQD,EAAQK,UAAU,CACxBhC,KAAMA,EACNiC,YAAY,EACZC,UAAW,CACTC,YAAaN,EACbO,mBApBoB,oBAsBtBC,WAAY,CAAC,CACXC,UAAW,YACXC,QAAS,GACR,CACDD,UAAW,cACXC,QAAS,SAEXC,aAAc,WACZzD,EAAE,sCAAsC0D,SAAS,4BACjD1D,EAAE,sBAAsB0D,SAAS,6BAEnCC,MAAO,CAAC,CAAC,EAAG,SACZC,OAAO,EACPC,cAAc,IA9FlB7D,EAAE8D,UAAUC,MAAM,WAChB,IAAIhD,EAAWd,EAAE+D,gBAAgB,YAGjChE,EALqBiE,iDAKDC,GAAG,QAAS,WAC9BrD,EAAWb,EAAEmE,MAAMlD,KAAK,YACxBjB,EARkB,iBAQCoE,KAAKpE,EAAEmE,MAAME,QAChCvD,EAAuBC,EAAUF,KAGnCC,EAAuBC,EAAUF","sourcesContent":["/* eslint-disable no-console */\r\ndefine([\r\n    'jquery',\r\n    'local_edwiserreports/variables',\r\n    'local_edwiserreports/jquery.dataTables',\r\n    'local_edwiserreports/dataTables.bootstrap4',\r\n    'local_edwiserreports/common'\r\n], function($, V) {\r\n    /**\r\n     * Initialize\r\n     * @param {integer} CONTEXTID Current page context id\r\n     */\r\n    function init(CONTEXTID) {\r\n        // eslint-disable-next-line no-unused-vars\r\n        CONTEXTID = null;\r\n        var PageId = $(\"#wdm-courseanalytics-individual\");\r\n        var RecentVisits = PageId.find(\".recent-visits .table\");\r\n        var RecentEnroled = PageId.find(\".recent-enrolment .table\");\r\n        var RecentCompletion = PageId.find(\".recent-completion .table\");\r\n        var loader = $(\".loader\");\r\n        var RecentVisitsTable = null;\r\n        var RecentEnroledTable = null;\r\n        var RecentCompletionTable = null;\r\n\r\n        // Varibales for cohort filter\r\n        var cohortId = 0;\r\n        var cohortFilterBtn = \"#cohortfilter\";\r\n        var cohortFilterItem = cohortFilterBtn + \" ~ .dropdown-menu .dropdown-item\";\r\n\r\n        $(document).ready(function() {\r\n            var courseId = V.getUrlParameter(\"courseid\");\r\n\r\n            /* Select cohort filter for active users block */\r\n            $(cohortFilterItem).on('click', function() {\r\n                cohortId = $(this).data('cohortid');\r\n                $(cohortFilterBtn).html($(this).text());\r\n                getCourseAnalyticsData(courseId, cohortId);\r\n            });\r\n\r\n            // Get Course Analytics Data\r\n            getCourseAnalyticsData(courseId, cohortId);\r\n        });\r\n\r\n        /**\r\n         * Get Course Analytics Data\r\n         * @param  {int} courseId Course Id\r\n         * @param  {int} cohortId Cohort Id\r\n         */\r\n        function getCourseAnalyticsData(courseId, cohortId) {\r\n            var sesskey = PageId.data(\"sesskey\");\r\n            $.ajax({\r\n                url: V.requestUrl,\r\n                type: V.requestType,\r\n                dataType: V.requestDataType,\r\n                data: {\r\n                    action: 'get_courseanalytics_data_ajax',\r\n                    sesskey: sesskey,\r\n                    data: JSON.stringify({\r\n                        courseid: courseId,\r\n                        cohortid: cohortId\r\n                    })\r\n                },\r\n            })\r\n                .done(function(response) {\r\n                    /* Generate Recent Visit Table */\r\n                    RecentVisitsTable = generateDataTable(RecentVisits, RecentVisitsTable, response.data.recentvisits);\r\n\r\n                    /* Generate Recent Enrolment Table */\r\n                    RecentEnroledTable = generateDataTable(RecentEnroled, RecentEnroledTable, response.data.recentenrolments);\r\n\r\n                    /* Generate Recent Completion Table */\r\n                    RecentCompletionTable = generateDataTable(\r\n                        RecentCompletion,\r\n                        RecentCompletionTable,\r\n                        response.data.recentcompletions\r\n                    );\r\n                })\r\n                .fail(function(error) {\r\n                    console.log(error);\r\n                }).always(function() {\r\n                    $(window).resize();\r\n                    PageId.fadeIn(\"slow\");\r\n                });\r\n        }\r\n\r\n        /**\r\n         * Generate Data Table for specific blocks\r\n         * @param  {string} tableId Table Id\r\n         * @param  {object} table Table Object\r\n         * @param  {array} data Data to create table\r\n         * @return {Objcet} Datatable object\r\n         */\r\n        function generateDataTable(tableId, table, data) {\r\n            var emptyStr = \"No users has Enrolled in this course\";\r\n            var searchPlaceholder = \"Search Analytics\";\r\n\r\n            if (tableId == RecentCompletion) {\r\n                emptyStr = \"No users has completed this course\";\r\n            } else if (tableId == RecentVisits) {\r\n                emptyStr = \"No users has visited this course\";\r\n            }\r\n\r\n            if (table !== null) {\r\n                table.destroy();\r\n            }\r\n\r\n            loader.hide();\r\n            tableId.fadeIn(\"slow\");\r\n            PageId.fadeIn(\"slow\");\r\n\r\n             table = tableId.DataTable({\r\n                data: data,\r\n                responsive: true,\r\n                oLanguage: {\r\n                    sEmptyTable: emptyStr,\r\n                    sSearchPlaceholder: searchPlaceholder\r\n                },\r\n                columnDefs: [\r\n                    {className: \"text-left\", targets: 0},\r\n                    {className: \"text-center\", targets: \"_all\"}\r\n                ],\r\n                drawCallback: function() {\r\n                    $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\r\n                    $('.dataTables_filter').addClass('pagination-sm pull-right');\r\n                },\r\n                order: [[1, 'desc']],\r\n                bInfo: false,\r\n                lengthChange: false,\r\n            });\r\n\r\n            // Return table\r\n            return table;\r\n        }\r\n    }\r\n\r\n    return {\r\n        init: init\r\n    };\r\n\r\n});\r\n"],"file":"courseanalytics.min.js"}