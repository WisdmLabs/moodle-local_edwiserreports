define(["jquery","core/modal_factory","core/modal_events","core/fragment","core/templates","report_elucidsitereport/variables","report_elucidsitereport/jquery.dataTables","report_elucidsitereport/dataTables.bootstrap4","report_elucidsitereport/common"],function(d,c,u,p,h,f){return{init:function(s){var r="#wdm-courseprogress-individual",t=r+" .table",a=r+" .loader",l=null,e="#cohortfilter",i=0,n=null;function o(e){n=d(r).data("sesskey"),d.ajax({url:f.requestUrl,data:{action:"get_courseprogress_graph_data_ajax",sesskey:n,data:JSON.stringify({courseid:"all",cohortid:e})}}).done(function(e){var o={courseprogress:e,sesskey:n};h.render("report_elucidsitereport/courseprogress",o).then(function(e,o){h.replaceNode(r,e,o),l=d(t).DataTable({dom:'<"pull-left"f><t><p>',order:[[0,"desc"]],bLengthChange:!1,initComplete:function(){d("#wdm-courseprogress-individual .dataTables_wrapper .row:first-child > div:first-child .dropdown").show()},columnDefs:[{targets:0,className:"text-left"},{targets:"_all",className:"text-center"}],language:{searchPlaceholder:"Search courses",emptyTable:"There are no courses"},scrollY:350,scrollX:!0,paginate:!1,sScrollX:"100%",bScrollCollapse:!0}),d(t).show(),d(a).hide()}).fail(function(e){console.log(e)}).always(function(){d(window).resize()})}).fail(function(e){console.log(e)})}d(document).ready(function(){o(i),d(document).on("click","#cohortfilter ~ .dropdown-menu .dropdown-item",function(){l&&(l.destroy(),d(t).hide(),d(a).show()),i=d(this).data("cohortid"),d(e).html(d(this).text()),o(i)}),d(document).on("click","#wdm-courseprogress-individual .table a.modal-trigger",function(){var e=d(this).data("minvalue"),o=d(this).data("maxvalue"),r=d(this).data("courseid"),t=d(this).data("coursename"),a=null;c.create({body:p.loadFragment("report_elucidsitereport","userslist",s,{page:"courseprogress",courseid:r,minval:e,maxval:o,cohortid:i})}).then(function(e){a=e.getRoot(),e.setTitle(t),e.show(),a.on(u.hidden,function(){e.destroy()}),a.on(u.bodyRendered,function(){var e=a.find(".modal-table");e.find("tbody").hasClass("empty")&&e.find("tbody").empty(),a.find(".modal-table").DataTable({language:{searchPlaceholder:"Search users",emptyTable:"There are no users"},scrollY:"350px",scrollX:!0,paging:!1,bInfo:!1})})})})})}}});