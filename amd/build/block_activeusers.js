define(["jquery","core/chartjs","report_elucidsitereport/defaultconfig","report_elucidsitereport/flatpickr"],function(C,b,f){return{init:function(){var o=f.activeUsersBlock,e=f.getPanel("#activeusersblock"),t=f.getPanel("#activeusersblock","body"),a=f.getPanel("#activeusersblock","title"),r=(f.getPanel("#activeusersblock","footer"),e+" .dropdown-menu"),n=r+" .dropdown-item",l=e+" .dropdown-toggle",d=e+" #flatpickrCalender",s=t+" .ct-chart",i=t+" .loader",p=e+" button[data-toggle='dropdown']",c=a+" .refresh",u=null;function g(e){C(s).addClass("d-none"),C(i).removeClass("d-none"),C.ajax({url:f.requestUrl,data:{action:"get_activeusers_graph_data_ajax",data:JSON.stringify({filter:e})}}).done(function(e){o.graph.data=e.data,o.graph.labels=e.labels}).fail(function(e){console.log(e)}).always(function(){m=function(){m&&m.destroy();return b.defaults.global.defaultFontFamily=o.graph.fontFamily,b.defaults.global.defaultFontStyle=o.graph.fontStyle,m=new b(o.ctx,{type:o.graph.type,data:function(){return{labels:o.graph.labels,datasets:[{label:o.graph.labelName.activeUsers,data:o.graph.data.activeUsers,backgroundColor:o.graph.backgroundColor.activeUsers,borderColor:o.graph.borderColor.activeUsers,pointBorderColor:o.graph.borderColor.activeUsers,pointBackgroundColor:o.graph.borderColor.activeUsers,pointStyle:o.graph.pointStyle},{label:o.graph.labelName.enrolments,data:o.graph.data.enrolments,backgroundColor:o.graph.backgroundColor.enrolments,borderColor:o.graph.borderColor.enrolments,pointBorderColor:o.graph.borderColor.enrolments,pointBackgroundColor:o.graph.borderColor.enrolments,pointStyle:o.graph.pointStyle},{label:o.graph.labelName.completionRate,data:o.graph.data.completionRate,backgroundColor:o.graph.backgroundColor.completionRate,borderColor:o.graph.borderColor.completionRate,pointBorderColor:o.graph.borderColor.completionRate,pointBackgroundColor:o.graph.borderColor.completionRate,pointStyle:o.graph.pointStyle}]}}(),options:o.graph.options})}(),setInterval(h,6e4),C(c).removeClass("refresh-spin"),C(i).addClass("d-none"),C(s).removeClass("d-none")})}function h(){C(a+" #updated-time > span.minute").html(parseInt(C(a+" #updated-time > span.minute").text())+1)}C(document).ready(function(){C(l).on("click",function(){C(r).addClass("show")}),C(document).click(function(e){C(e.target).hasClass("dropdown-menu")||C(e.target).parents(".dropdown-menu").length?e.preventDefault():C(r).removeClass("show")}),C(n+":not(.custom)").on("click",function(){u=C(this).attr("value"),C(r).removeClass("show"),C(p).html(C(this).text()),g(u)}),C(c).on("click",function(){C(this).addClass("refresh-spin"),C(a+" #updated-time > span.minute").html(0),g(u)}),C(d).flatpickr({mode:"range",altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",appendTo:document.getElementById("activeUser-calendar"),onOpen:function(e){C(r).addClass("withcalendar")},onClose:function(){C(r).removeClass("withcalendar"),C(r).removeClass("show"),(u=C(d).val()).includes("to")&&(C(p).html(u),C(d).val(""),g(u))}})});var m=g()}}});