define(["jquery","core/str","report_elucidsitereport/defaultconfig","report_elucidsitereport/variables","report_elucidsitereport/flatpickr","report_elucidsitereport/jquery.dataTables","report_elucidsitereport/dataTables.bootstrap4"],function(s,e,t,i){function r(e){return c+" "+e+" input[name^=customReportSelect-]"}var d=null,c=t.getPanel("#customReportBlock"),a=c+" .dropdown-menu .dropdown-item",o="courses",n=c+" #customReportDownload",l=s(c).find("#customReportDrodown"),u=s(c).find("#customReportsForm"),p="report_elucidsitereport";e.get_strings([{key:"customreportselectfailed",component:p},{key:"customreportdatefailed",component:p}]);s(c).find(".custom-flatpicker").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",maxDate:"today",onClose:function(e,t,a){if(e[0])if(s("#wdmCustomReportEnrolStart").is(a.element)){var r=e[0].getTime();u.find("input[name=enrolstartdate]").val(r/1e3)}else if(s("#wdmCustomReportEnrolEnd").is(a.element)){var o=e[0].getTime();u.find("input[name=enrolenddate]").val(o/1e3)}}}),s(document).on("click",".custom-flatpicker ~ button.input-search-close",function(){s(".custom-flatpicker ~ input.form-control").val(""),u.find("input[name=enrolstartdate]").val(""),u.find("input[name=enrolenddate]").val("")}),s(document).on("change",c+' input[name="selectAllCustom"]',function(e){var t=".course-table";"lps"==o&&(t=".lp-table");var a=r(t);s(e.target).is(":checked")?s(a).prop("checked",!0):s(a).prop("checked",!1)}),s(document).on("click",a,function(e){s(e.target).closest(".dropdown");o=s(e.target).data("val"),l.html(s(e.target).html()),l.data("val",o);var t=".course-table";"lps"==o&&(t=".lp-table"),s(c).find(".table").hide(),u.find("input[name=reporttype]").val(o),function(e,t){d&&d.destroy(),s(c+" .enrol-selector").show(),s(c+' input[name="selectAllCustom"]').prop("checked",!1);var a=s(c).find(".customReportSelectors"),r=s(c).find(".rootContainer"),o=JSON.stringify({type:e}),n=i.requestUrl+"?action=get_customreport_selectors_ajax&sesskey="+M.cfg.sesskey+"&filter="+o;r.show();var l=function(e){return"lps"==e?{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"startdate"},{data:"enddate"},{data:"duration"}],language:{searchPlaceholder:"Search Learning Programs",emptyTable:"There are no learning programs"}}:{columns:[{data:"select"},{data:"fullname"},{data:"shortname"},{data:"category"},{data:"startdate"},{data:"enddate"}],language:{searchPlaceholder:"Search courses",emptyTable:"There are no courses"}}}(e);d=a.find(t).show().DataTable({ajax:n,columns:l.columns,language:l.language,responsive:!0,scrollY:"380px",scroller:{loadingIndicator:!0},scrollCollapse:!0,scrollX:!0,paging:!1,bInfo:!1,bSort:!1}).columns.adjust()}(o,t)}),s(document).on("click",n,function(e){if(!function(){var e=u.find('input[name="enrolstartdate"]').val(),t=u.find('input[name="enrolenddate"]').val();return""==t&&""==e||!(t<e)}())return s(c).find("#errorMsg").html(M.util.get_string("customreportdatefailed",p)).addClass("show").removeClass("hide"),setTimeout(function(){s(c).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;var t=".course-table";"lps"==o&&(t=".lp-table");var a=r(t);if(!s(a+":checked").length)return s(c).find("#errorMsg").html(M.util.get_string("customreportselectfailed",p)).addClass("show").removeClass("hide"),setTimeout(function(){s(c).find("#errorMsg").addClass("hide").removeClass("show")},5e3),!1;filters=[],s(a+":checked").each(function(e,t){filters.push(s(t).data("id"))}),u.find("input[name=filters]").val(filters.join(","))})});