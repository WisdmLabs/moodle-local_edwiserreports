define(["jquery","core/templates","core/fragment","core/modal_factory","core/modal_events","core/str","local_sitereport/variables","local_sitereport/common"],(function(e,t,o,r,n,i,l){return{init:function(d){var c="#wdm-lpstats-individual",a="#wdm-lp-select",s=c+" .table",p=c+" .loader",u=e("#wdm-userfilter .row .col-md-6:first-child"),f=e(c).find("#wdm-lp-dropdown"),m=null,h=e("#wdm-export-detail-lpsreports"),g=null,w=i.get_strings([{key:"lpdetailedreport",component:"local_sitereport"}]),v=0;function y(r,n){m&&(m.destroy(),e(s).hide(),e(p).show()),o.loadFragment("local_sitereport","lpstats",d,{lpid:r,cohortid:n}).done((function(o){var r=JSON.parse(o);t.render("local_sitereport/lpstatsinfo",r).then((function(e,o){t.replaceNode(s,e,o)})).fail((function(e){console.log(e)})).always((function(){e(s).show(),m=e(s).DataTable({dom:"<'pull-left'f><t><p>",oLanguage:{sEmptyTable:"No Users are enrolled in any Learning Programs"},responsive:!0}),e(p).hide()}))}))}e(document).ready((function(){u.html(f.html()),e(document).find(a).select2(),e(document).find(a).show(),f.remove();var o=e(document).find(a).val();y(o,v),e(l.cohortFilterItem).on("click",(function(){v=e(this).data("cohortid"),e(l.cohortFilterBtn).html(e(this).text()),l.changeExportUrl(v,l.exportUrlLink,l.cohortReplaceFlag),y(o,v)})),e(document).find(a).on("change",(function(){e(s).hide(),e(p).show(),o=e(document).find(a).val(),l.changeExportUrl(o,l.exportUrlLink,l.filterReplaceFlag),y(o,v)})),h.on("click",(function(){var o;o=h,g?g.show():w.then((function(){r.create({title:M.util.get_string("lpdetailedreport","local_sitereport")},o).done((function(o){var r=o.getRoot();g=o,r.on(n.cancel,(function(){o.hide()})),o.setBody(t.render("local_sitereport/lpdetailedreport",{sesskey:e(c).data("sesskey"),formaction:M.cfg.wwwroot+"/local/sitereport/download.php"})),o.show()}))}))}))}))}}}));