define(["jquery","core/templates","core/fragment","core/modal_factory","core/modal_events","core/str","report_elucidsitereport/variables","report_elucidsitereport/common"],function(h,g,w,v,y,e,_){return{init:function(o){var r="#wdm-lpstats-individual",t="#wdm-lp-select",n=r+" .table",i=r+" .loader",l=h("#wdm-userfilter .row .col-md-6:first-child"),d=h(r).find("#wdm-lp-dropdown"),c=null,a=h("#wdm-export-detail-lpsreports"),s=null,p="report_elucidsitereport",u=e.get_strings([{key:"lpdetailedreport",component:p}]),f=0;function m(e,t){c&&(c.destroy(),h(n).hide(),h(i).show()),w.loadFragment("report_elucidsitereport","lpstats",o,{lpid:e,cohortid:t}).done(function(e){var t=JSON.parse(e);g.render("report_elucidsitereport/lpstatsinfo",t).then(function(e,t){g.replaceNode(n,e,t)}).fail(function(e){console.log(e)}).always(function(){h(n).show(),c=h(n).DataTable({dom:"<'pull-left'f><t><p>",oLanguage:{sEmptyTable:"No Users are enrolled in any Learning Programs"},responsive:!0}),h(i).hide()})})}h(document).ready(function(){l.html(d.html()),h(document).find(t).select2(),h(document).find(t).show(),d.remove();var e=h(document).find(t).val();m(e,f),h(_.cohortFilterItem).on("click",function(){f=h(this).data("cohortid"),h(_.cohortFilterBtn).html(h(this).text()),_.changeExportUrl(f,_.exportUrlLink,_.cohortReplaceFlag),m(e,f)}),h(document).find(t).on("change",function(){h(n).hide(),h(i).show(),e=h(document).find(t).val(),_.changeExportUrl(e,_.exportUrlLink,_.filterReplaceFlag),m(e,f)}),a.on("click",function(){var e;e=a,s?s.show():u.then(function(){v.create({title:M.util.get_string("lpdetailedreport",p)},e).done(function(e){var t=e.getRoot();s=e,t.on(y.cancel,function(){e.hide()}),e.setBody(g.render("report_elucidsitereport/lpdetailedreport",{sesskey:h(r).data("sesskey"),formaction:M.cfg.wwwroot+"/report/elucidsitereport/download.php"})),e.show()})})})})}}});