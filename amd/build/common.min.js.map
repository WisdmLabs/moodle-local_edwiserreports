{"version":3,"sources":["common.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","$","notif","fragment","ModalFactory","ModalEvents","Templates","str","v","selector","tempSelector","jsPDF","emailListTable","formRoot","dropdowns","dropdownSelector","durationSelector","durationInput","timesDropdown","timesDropdownBtn","timesDropdownLink","dailyDropdownBtn","weeklyDropdownBtn","monthlyDropdownBtn","timeInput","settingBtn","deleteBtn","emailListToggleSwitch","schedulerrormsg","M","util","get_string","schedulesuccessmsg","deletesuccessmsg","deleteerrormsg","emptyerrormsg","emailinvaliderrormsg","tabs","formTab","windowLoader","loader","show","id","$class","undefined","append","concat","hide","remove","switchCapabilitiesBlock","modal","find","on","event","permissions","currentTarget","current","filter","next","eq","index","length","prop","perStr","data","perClass","removeClass","addClass","html","render_all_scheduled_emails","table","getRoot","document","window","resize","DataTable","ajax","url","requestUrl","sesskey","type","requestType","action","JSON","stringify","blockname","block","region","language","searchPlaceholder","emptyTable","sClass","drawCallback","order","columns","orderable","responsive","bInfo","lengthChange","ready","e","preventDefault","form","this","closest","attr","val","cohortid","done","response","parse","pdf","margins","top","bottom","left","width","setFontSize","fromHTML","elementHandlers","#bypassme","element","renderer","dispose","save","filename","always","getScheduledEmailFormContext","formData","serializeArray","each","$k","$d","name","value","modalTitle","includes","create","title","body","render","root","bodyRendered","hidden","destroy","_this","text","dropdownBtn","subDropdown","timeval","duration_dropdown_init","error","console","log","esrDurationVal","esrTimeVal","idx","esrDuration","click","checkbox","subSelectedDropdpown","set_email_shedule_form_values","fail","email_schedule_setting_init","get_strings","key","component","s","confirm","proxy","errorBox","delay","fadeOut","email_schedule_delete_init","errormsg","successmsg","change_scheduled_email_status_init","cfg","wwwroot","serialize","parseJSON","sendMailToUser","esrname","esrrecepient","test","validate_email_scheduled_form","save_schedule_email_init","email_schedule_form_init","blockSettingsBtn","contextid","loadFragment","addNotification","message","location","reload","set_block_preference","success","capvalue","capabilities","js","css","callback","setBlockCapabilities","editing","editingtxt","editForm","setupBlockHiding"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\r\n/* eslint-disable camelcase */\r\ndefine([\r\n    'jquery',\r\n    'core/notification',\r\n    'core/fragment',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/templates',\r\n    'core/str',\r\n    'local_edwiserreports/variables',\r\n    'local_edwiserreports/selectors',\r\n    'local_edwiserreports/templateselector',\r\n    'local_edwiserreports/jspdf',\r\n    'local_edwiserreports/select2',\r\n    'local_edwiserreports/jquery.dataTables',\r\n    'local_edwiserreports/dataTables.bootstrap4'\r\n], function(\r\n    $,\r\n    notif,\r\n    fragment,\r\n    ModalFactory,\r\n    ModalEvents,\r\n    Templates,\r\n    str,\r\n    v,\r\n    selector,\r\n    tempSelector,\r\n    jsPDF\r\n) {\r\n    var emailListTable = null;\r\n    /**\r\n     * Email Shcedule Modal Related Psrametres start\r\n     */\r\n    // Form root\r\n    var formRoot = '#scheduletab';\r\n\r\n    // Dropdowns\r\n    var dropdowns = formRoot + ' .dropdown a.dropdown-item';\r\n    var dropdownSelector = 'button.dropdown-toggle';\r\n\r\n    // Duration dropdown selectors\r\n    var durationSelector = formRoot + ' .dropdown.duration-dropdown a.dropdown-item';\r\n    var durationInput = formRoot + ' input#esr-sendduration';\r\n\r\n    // Times dropdown selector\r\n    var timesDropdown = formRoot + ' .dropdown:not(.duration-dropdown)';\r\n    var timesDropdownBtn = timesDropdown + ' button.dropdown-toggle';\r\n    var timesDropdownLink = timesDropdown + ' a.dropdown-item';\r\n    var dailyDropdownBtn = formRoot + ' .dropdown.daily-dropdown button.dropdown-toggle';\r\n    var weeklyDropdownBtn = formRoot + ' .dropdown.weekly-dropdown button.dropdown-toggle';\r\n    var monthlyDropdownBtn = formRoot + ' .dropdown.monthly-dropdown button.dropdown-toggle';\r\n\r\n    var timeInput = formRoot + ' input#esr-sendtime';\r\n\r\n    // For email schedule setting\r\n    var settingBtn = \"#listemailstab .esr-email-sched-setting\";\r\n    var deleteBtn = \"#listemailstab .esr-email-sched-delete\";\r\n    var emailListToggleSwitch = \"#listemailstab [id^='esr-toggle-']\";\r\n\r\n    // Messaged for email schedule\r\n    var schedulerrormsg = M.util.get_string('scheduleerrormsg', 'local_edwiserreports');\r\n    var schedulesuccessmsg = M.util.get_string('schedulesuccessmsg', 'local_edwiserreports');\r\n    var deletesuccessmsg = M.util.get_string('deletesuccessmsg', 'local_edwiserreports');\r\n    var deleteerrormsg = M.util.get_string('deleteerrormsg', 'local_edwiserreports');\r\n    var emptyerrormsg = M.util.get_string('emptyerrormsg', 'local_edwiserreports');\r\n    var emailinvaliderrormsg = M.util.get_string('emailinvaliderrormsg', 'local_edwiserreports');\r\n\r\n    var tabs = '[data-plugin=\"tabs\"] .nav-link, [data-plugin=\"tabs\"] .tab-pane';\r\n    var formTab = '[aria-controls=\"scheduletab\"], #scheduletab';\r\n\r\n    var windowLoader = '<div id=\"cover-spin\"></div>';\r\n\r\n    // Loader functions.\r\n    var loader = {\r\n        show: function(id) {\r\n            var $class;\r\n            if (id == undefined) {\r\n                id = 'body';\r\n                $class = 'position-fixed';\r\n            } else {\r\n                $class = 'position-absolute';\r\n            }\r\n            $(id).append(`\r\n            <div class=\"edwiserreports-loader ${$class}\">\r\n                <i class=\"fa fa-circle-o-notch fa-spin\" aria-hidden=\"true\"></i>\r\n            </div>\r\n            `);\r\n        },\r\n        hide: function(id) {\r\n            if (id == undefined) {\r\n                id = 'body';\r\n            }\r\n            $(id + ' > .edwiserreports-loader').remove();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Email Shcedule Modal Related Psrametres end\r\n     */\r\n\r\n    $(document).ready(function() {\r\n        var exportPdf = '.download-links button[value=\"pdf\"]';\r\n        var scheduledEmailDropdown = '.download-links button[value=\"email\"]';\r\n\r\n        // Export data in pdf\r\n        $(document).on(\"click\", exportPdf, function(e) {\r\n            e.preventDefault();\r\n\r\n            var _this = this;\r\n            var form = $(_this).closest(\"form\");\r\n            $.ajax({\r\n                url: form.attr('action'),\r\n                type: 'POST',\r\n                data: {\r\n                    'type': $(_this).val(),\r\n                    'block': form.find('input[name=\"block\"]').val(),\r\n                    'filter': form.find('input[name=\"filter\"]').val(),\r\n                    'cohortid': form.find('input[name=\"cohortid\"]').val(),\r\n                    'region': form.find('input[name=\"region\"]').val()\r\n                }\r\n            }).done(function(response) {\r\n                response = JSON.parse(response);\r\n                var pdf = jsPDF('p', 'pt', 'a4');\r\n                var margins = {\r\n                    top: 40,\r\n                    bottom: 30,\r\n                    left: 10,\r\n                    width: \"100%\"\r\n                };\r\n\r\n                pdf.setFontSize(10);\r\n\r\n                // ID selector for either ID or node name. (\"#iAmID\", \"div\", \"span\" etc.)\r\n                // There is no support for any other type of selectors\r\n                // (class, of compound) at this time.\r\n                var specialElementHandlers = {\r\n                    // Element with id of \"bypass\" - jQuery style selector\r\n                    // eslint-disable-next-line no-unused-vars\r\n                    '#bypassme': function(element, renderer) {\r\n                        // True = \"handled elsewhere, bypass text extraction\"\r\n                        return true;\r\n                    }\r\n                };\r\n                // All coords and widths are in jsPDF instance's declared units\r\n                // 'inches' in this case\r\n                pdf.fromHTML(\r\n                    response.data.html, // HTML string or DOM elem ref.\r\n                    margins.left, // X coord\r\n                    margins.top, { // Y coord\r\n                    'width': margins.width, // Max width of content on PDF\r\n                    'elementHandlers': specialElementHandlers\r\n                    },\r\n                    // eslint-disable-next-line no-unused-vars\r\n                    function(dispose) {\r\n                        // Dispose: object with X, Y of the last line add to the PDF\r\n                        //          this allow the insertion of new lines after html\r\n                        pdf.save(response.data.filename);\r\n                    }, margins);\r\n            }).always(function() {\r\n                $(document).find('#cover-spin').hide();\r\n            });\r\n        });\r\n\r\n        /**\r\n         * Schedule emails to send reports                                    e.preventDefault();            var _this [description]\r\n         */\r\n        $(document).on(\"click\", scheduledEmailDropdown, function(e) {\r\n            e.preventDefault();\r\n            var data = v.getScheduledEmailFormContext();\r\n            var form = $(this).closest('form');\r\n            var formData = form.serializeArray();\r\n            $(formData).each(function($k, $d) {\r\n                data[$d.name] = $d.value;\r\n            });\r\n\r\n            var modalTitle = M.util.get_string('scheduleemailfor', 'local_edwiserreports');\r\n            if (data.block.includes(\"customreportsblock\")) {\r\n                modalTitle += ' ' + $('#' + data.block).data('blockname');\r\n            } else {\r\n                modalTitle += ' ' + M.util.get_string(data.block + 'exportheader', 'local_edwiserreports');\r\n            }\r\n\r\n            ModalFactory.create({\r\n                title: modalTitle,\r\n                body: Templates.render('local_edwiserreports/email_schedule_tabs', data)\r\n            }, $(this))\r\n                .done(function(modal) {\r\n                    var root = modal.getRoot();\r\n\r\n                    modal.modal.addClass(\"modal-lg\");\r\n\r\n                    root.on(ModalEvents.bodyRendered, function() {\r\n                        root.find(\"#esr-blockname\").val(data.blockname);\r\n                        root.find(\"#esr-region\").val(data.region);\r\n                        root.find(\"#esr-sesskey\").val(data.sesskey);\r\n                        emailListTable = render_all_scheduled_emails(data, modal);\r\n                    });\r\n\r\n                    root.on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n\r\n                    email_schedule_form_init(data, root, modal);\r\n                    modal.show();\r\n                });\r\n        });\r\n\r\n        // Show reports page when document is ready\r\n        $('#wdm-edwiserreports').removeClass('d-none');\r\n\r\n        setupBlockEditing();\r\n\r\n        setupBlockHiding($('#wdm-edwiserreports').data(\"editing\"));\r\n    });\r\n\r\n    /**\r\n     * Setup block hiding\r\n     * @param {Boolean} editing True if editing is on\r\n     */\r\n    function setupBlockHiding(editing) {\r\n        var editForm = '<div id=\"editing-btn\" class=\"d-flex flex-wrap\">';\r\n        editForm += '<div class=\"ml-auto d-flex\">';\r\n        var editingtxt;\r\n\r\n        // Change editing option\r\n        if (editing) {\r\n            editing = 0;\r\n            editingtxt = \"Stop Customising this page\";\r\n\r\n            editForm += '<div class=\"singlebutton\">';\r\n            editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\r\n            editForm += '<input type=\"hidden\" name=\"reset\" value=\"1\">';\r\n            editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\r\n            editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">Reset Page to Default</button>';\r\n            editForm += '</form>';\r\n            editForm += '</div>';\r\n        } else {\r\n            editing = 1;\r\n            editingtxt = \"Customise this page\";\r\n        }\r\n\r\n        editForm += '<div class=\"singlebutton\">';\r\n        editForm += '<form method=\"post\" action=\"' + M.cfg.wwwroot + '/local/edwiserreports/index.php\">';\r\n        editForm += '<input type=\"hidden\" name=\"edit\" value=\"' + editing + '\">';\r\n        editForm += '<input type=\"hidden\" name=\"sesskey\" value=\"' + M.cfg.sesskey + '\">';\r\n        editForm += '<button type=\"submit\" class=\"btn btn-secondary\" title=\"\">' + editingtxt + '</button>';\r\n        editForm += '</form>';\r\n        editForm += '</div>';\r\n\r\n        editForm += '</div></div>';\r\n\r\n        $(\"#page-local-edwiserreports-index #page-header .card-body\").append(editForm);\r\n    }\r\n\r\n    /**\r\n     * Setup block setting button\r\n     */\r\n    function setupBlockEditing() {\r\n        $(document).on('click', selector.blockSettingsBtn, function(e) {\r\n            e.preventDefault();\r\n\r\n            var contextid = $(e.currentTarget).data('contextid');\r\n            var blockname = $(e.currentTarget).data('blockname');\r\n            var action = $(e.currentTarget).data('action');\r\n\r\n            if (action == 'edit') {\r\n                ModalFactory.create({\r\n                    title: 'Edit Block Setting',\r\n                    body: fragment.loadFragment(\r\n                        'local_edwiserreports',\r\n                        'get_blocksetting_form',\r\n                        contextid,\r\n                        {\r\n                            blockname: blockname\r\n                        }\r\n                    )\r\n                }).done(function(modal) {\r\n                    var root = modal.getRoot();\r\n                    modal.modal.addClass('modal-dialog-centered');\r\n\r\n                    root.on(ModalEvents.bodyRendered, function() {\r\n                        var form = modal.modal.find('.block-settings-form');\r\n                        modal.modal.find('.save-block-settings').on('click', function(event) {\r\n                            event.preventDefault();\r\n                            var formData = form.serializeArray();\r\n                            var data = {};\r\n                            $(formData).each(function($k, $d) {\r\n                                data[$d.name] = $d.value;\r\n                            });\r\n\r\n                            // Set users preferences\r\n                            set_block_preference(blockname, data);\r\n                        });\r\n                    });\r\n\r\n                    root.on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    modal.show();\r\n                });\r\n            } else if (action == \"hide\") {\r\n                var hidden = $(this).data(\"hidden\");\r\n                var _this = $(this);\r\n                $.ajax({\r\n                    url: v.requestUrl,\r\n                    type: 'GET',\r\n                    data: {\r\n                        action: 'toggle_hide_block_ajax',\r\n                        sesskey: M.cfg.sesskey,\r\n                        data: JSON.stringify({\r\n                            'blockname': blockname,\r\n                            'hidden': hidden\r\n                        })\r\n                    }\r\n                }).done(function(response) {\r\n                    response = JSON.parse(response);\r\n                    if (response.success) {\r\n                        if (hidden) {\r\n                            _this.closest('.edwiserReport-block').removeClass('block-hidden');\r\n                            _this.data(\"hidden\", 0);\r\n                            _this.html(M.util.get_string('hide', 'local_edwiserreports'));\r\n                        } else {\r\n                            _this.closest('.edwiserReport-block').addClass('block-hidden');\r\n                            _this.data(\"hidden\", 1);\r\n                            _this.html(M.util.get_string('unhide', 'local_edwiserreports'));\r\n                        }\r\n                    }\r\n                });\r\n            } else if (action == \"editcap\") {\r\n                ModalFactory.create({\r\n                    title: 'Edit Block Capabilities',\r\n                    body: fragment.loadFragment(\r\n                        'local_edwiserreports',\r\n                        'get_blockscap_form',\r\n                        contextid,\r\n                        {\r\n                            blockname: blockname\r\n                        }\r\n                    )\r\n                }).done(function(modal) {\r\n                    var root = modal.getRoot();\r\n                    modal.modal.addClass('modal-dialog-centered modal-lg');\r\n\r\n                    root.on(ModalEvents.bodyRendered, function() {\r\n                        var form = modal.modal.find('.block-cap-form');\r\n                        modal.modal.find('#menucapabilities').on('change', function(event) {\r\n                            event.preventDefault();\r\n                            var formData = form.serializeArray();\r\n                            var data = {};\r\n                            $(formData).each(function($k, $d) {\r\n                                data[$d.name] = $d.value;\r\n                            });\r\n\r\n                            fragment.loadFragment(\r\n                                'local_edwiserreports',\r\n                                'block_overview_display',\r\n                                contextid,\r\n                                {\r\n                                    capvalue: data.capabilities\r\n                                }\r\n                            // eslint-disable-next-line no-unused-vars\r\n                            ).done(function(html, js, css) {\r\n                                modal.modal.find('.cap-overview').html(html);\r\n                                switchCapabilitiesBlock(modal);\r\n                            });\r\n                        });\r\n\r\n                        switchCapabilitiesBlock(modal);\r\n\r\n                        form = modal.modal.find('.block-cap-form');\r\n                        modal.modal.find('.save-block-caps').on('click', function(event) {\r\n                            event.preventDefault();\r\n                            var formData = form.serializeArray();\r\n                            var data = {};\r\n                            $(formData).each(function($k, $d) {\r\n                                data[$d.name] = $d.value;\r\n                            });\r\n\r\n                            // Set block capabilities\r\n                            setBlockCapabilities(blockname, data, function() {\r\n                                modal.destroy();\r\n                            });\r\n                        });\r\n                    });\r\n\r\n                    root.on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n                    modal.show();\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Switch capability block.\r\n     * @param {Object} modal Modal object\r\n     */\r\n    function switchCapabilitiesBlock(modal) {\r\n        modal.modal.find('.comparisontable .switch-capability').on('click', function(event) {\r\n            var permissions = $(event.currentTarget).find('input[type=radio]');\r\n            var current = permissions.filter(':checked');\r\n            var next = permissions.eq(permissions.index(current) + 1);\r\n            if (next.length === 0) {\r\n                next = permissions.eq(0);\r\n            }\r\n            next.prop('checked', true);\r\n\r\n            var perStr = next.data('strpermission');\r\n            var perClass = next.data('permissionclass');\r\n\r\n            $(event.currentTarget).removeClass('inherit allow prevent prohibit');\r\n            $(event.currentTarget).addClass(perClass);\r\n            $(event.currentTarget).find('label').html(perStr);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set blocks capabilities\r\n     * @param {string} blockname\r\n     * @param {string} data\r\n     * @param {function} callback\r\n     */\r\n    function setBlockCapabilities(blockname, data, callback) {\r\n        data.blockname = blockname;\r\n        data = JSON.stringify(data);\r\n        var sesskey = $('#' + blockname).data('sesskey');\r\n\r\n        // Update users capability\r\n        $.ajax({\r\n            url: v.requestUrl,\r\n            type: 'GET',\r\n            data: {\r\n                action: 'set_block_capability_ajax',\r\n                sesskey: sesskey,\r\n                data: data\r\n            }\r\n        }).done(function(response) {\r\n            response = JSON.parse(response);\r\n            if (response.success) {\r\n                callback();\r\n                location.reload();\r\n            } else {\r\n                notif.addNotification({\r\n                    message: \"Error\",\r\n                    type: \"error\"\r\n                });\r\n            }\r\n        }).fail(function(error) {\r\n            console.log(error);\r\n            notif.addNotification({\r\n                message: error,\r\n                type: \"error\"\r\n            });\r\n        }).always(function() {\r\n            callback();\r\n            location.reload();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set users preferences\r\n     * @param {string} blockname Block name\r\n     * @param {string} data Data for preference\r\n     */\r\n    function set_block_preference(blockname, data) {\r\n        data.blockname = blockname;\r\n        data = JSON.stringify(data);\r\n        var sesskey = $('#' + blockname).data('sesskey');\r\n\r\n        // Set users preferences\r\n        $.ajax({\r\n            url: v.requestUrl,\r\n            type: 'GET',\r\n            data: {\r\n                action: 'set_block_preferences_ajax',\r\n                sesskey: sesskey,\r\n                data: data\r\n            }\r\n        }).fail(function(error) {\r\n            console.log(error);\r\n            notif.addNotification({\r\n                message: error,\r\n                type: \"error\"\r\n            });\r\n        }).always(function() {\r\n            location.reload();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Render all emails in modal\r\n     * @param {object} data Data for datatable\r\n     * @param {Object} modal Modal object\r\n     * @return {Object} Datatable object\r\n     */\r\n    function render_all_scheduled_emails(data, modal) {\r\n        var table = modal.getRoot().find(\"#esr-shceduled-emails\");\r\n\r\n        // Resize event to adjust datatable when click on the all list tab\r\n        // Not able to call resize when ajax completed\r\n        // So got the temporary solution\r\n        $(document).on('click', '[aria-controls=\"listemailstab\"]', function() {\r\n            $(window).resize();\r\n        });\r\n\r\n        // Create datatable\r\n        return table.DataTable({\r\n            ajax: {\r\n                url: v.requestUrl + '?sesskey=' + data.sesskey,\r\n                type: v.requestType,\r\n                data: {\r\n                    action: 'get_scheduled_emails_ajax',\r\n                    data: JSON.stringify({\r\n                        blockname: data.block,\r\n                        region: data.region\r\n                    })\r\n                }\r\n            },\r\n            language: {\r\n                searchPlaceholder: \"Search shceduled email\",\r\n                emptyTable: \"There is no scheduled emails\",\r\n                sClass: 'text-center'\r\n            },\r\n            drawCallback: function() {\r\n                $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\r\n                $('.dataTables_filter').addClass('pagination-sm pull-right');\r\n            },\r\n            order: [[2, \"asc\"]],\r\n            columns: [\r\n                {\r\n                    \"data\": \"esrname\",\r\n                    \"orderable\": true\r\n                },\r\n                {\r\n                    \"data\": \"esrnextrun\",\r\n                    \"orderable\": true\r\n                },\r\n                {\r\n                    \"data\": \"esrfrequency\",\r\n                    \"orderable\": true\r\n                },\r\n                {\r\n                    \"data\": \"esrmanage\",\r\n                    \"orderable\": false\r\n                }\r\n            ],\r\n            responsive: true,\r\n            bInfo: false,\r\n            lengthChange: false,\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Validate email shceduled form\r\n     * @param  {object} form Form object\r\n     * @param  {object} errorBox Box to show error\r\n     * @return {boolean} Return form validation status\r\n     */\r\n    function validate_email_scheduled_form(form, errorBox) {\r\n        var esrname = form.find('[name=\"esrname\"]').val();\r\n        var esrrecepient = form.find('[name=\"esrrecepient\"]').val();\r\n        if (esrname == \"\" || esrrecepient == \"\") {\r\n            errorBox.html(emptyerrormsg).show();\r\n            return false;\r\n        }\r\n\r\n        var re = /^(\\s?[^\\s,]+@[^\\s,]+\\.[^\\s,]+\\s?,)*(\\s?[^\\s,]+@[^\\s,]+\\.[^\\s,]+)$/g;\r\n        if (!re.test(esrrecepient)) {\r\n            errorBox.html(emailinvaliderrormsg).show();\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Save scheduled emails\r\n     * @param {Object} data Data for email\r\n     * @param {object} root Modal root object\r\n     * @param {Object} modal Modal object\r\n     */\r\n    function save_schedule_email_init(data, root, modal) {\r\n        // On save perform operation\r\n        root.on('click', '[data-action=\"save\"]', function() {\r\n            var errorBox = root.find(\".esr-form-error\");\r\n            errorBox.html(loader).show();\r\n\r\n            if (validate_email_scheduled_form(root.find(\"form\"), errorBox)) {\r\n                var filter = data.filter;\r\n                var cohortid = data.cohortid;\r\n                var block = data.block;\r\n                var url = M.cfg.wwwroot + \"/local/edwiserreports/download.php?type=emailscheduled&filter=\"\r\n                + filter + \"&cohortid=\" + cohortid + \"&block=\" + block;\r\n\r\n                // Send ajax to save the scheduled email\r\n                $.ajax({\r\n                    url: url,\r\n                    type: \"POST\",\r\n                    data: root.find(\"form\").serialize()\r\n                }).done(function(response) {\r\n                    response = $.parseJSON(response);\r\n\r\n                    // If error then log the error\r\n                    if (response.error) {\r\n                        errorBox.html(schedulerrormsg);\r\n                        console.log(response.error);\r\n                    } else {\r\n                        if (emailListTable) {\r\n                            emailListTable.destroy();\r\n                        }\r\n                        emailListTable = render_all_scheduled_emails(data, modal);\r\n                        errorBox.html(schedulesuccessmsg);\r\n                    }\r\n                }).fail(function(error) {\r\n                    errorBox.html(schedulerrormsg);\r\n                    console.log(error);\r\n                }).always(function() {\r\n                    errorBox.delay(3000).fadeOut('slow');\r\n                });\r\n            }\r\n        });\r\n\r\n        // Reset scheduled form\r\n        root.on('click', '[data-action=\"cancel\"]', function() {\r\n            root.find('[name^=esr]:not(.d-none):not([id=\"esr-toggle-\"])').val(\"\");\r\n            root.find('#esr-id').val(-1);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update dropdown button text\r\n     * @param  {object} _this click object\r\n     */\r\n    function update_dropdown_btn_text(_this) {\r\n        var val = $(_this).data('value');\r\n        var text = $(_this).text();\r\n        var dropdownBtn = $(_this).closest(\".dropdown\").find(dropdownSelector);\r\n\r\n        // Set button values\r\n        dropdownBtn.text(text);\r\n        dropdownBtn.data(\"value\", val);\r\n    }\r\n\r\n    /**\r\n     * Duration dropdown init\r\n     * @param {object} _this click object\r\n     * @param {Object} root Modal root obuject\r\n     */\r\n    function duration_dropdown_init(_this, root) {\r\n        var val = $(_this).data('value');\r\n\r\n        root.find(durationInput).val(val);\r\n        $(timesDropdownBtn).hide();\r\n\r\n        // Show only selected dropdown\r\n        var subDropdown = null;\r\n        switch (val) {\r\n            case 1: // Weekly\r\n                subDropdown = $(weeklyDropdownBtn);\r\n                break;\r\n            case 2: // Monthly\r\n                subDropdown = $(monthlyDropdownBtn);\r\n                break;\r\n            default: // Daily\r\n                subDropdown = $(dailyDropdownBtn);\r\n        }\r\n\r\n        // Show subdropdown\r\n        subDropdown.show();\r\n\r\n        // Set values to hidden input fieds\r\n        var timeval = subDropdown.data(\"value\");\r\n        $(timeInput).val(timeval);\r\n    }\r\n\r\n    /**\r\n     * Email schedle setting session initialization\r\n     * @param {object} _this click object\r\n     * @param {Object} root Modal root obuject\r\n     */\r\n    function email_schedule_setting_init(_this, root) {\r\n        var id = $(_this).data(\"id\");\r\n        var blockname = $(_this).data(\"blockname\");\r\n        var region = $(_this).data(\"region\");\r\n\r\n        $.ajax({\r\n            url: v.requestUrl,\r\n            type: v.requestType,\r\n            sesskey: $(_this).data(\"sesskey\"),\r\n            data: {\r\n                action: 'get_scheduled_email_detail_ajax',\r\n                sesskey: $(_this).data(\"sesskey\"),\r\n                data: JSON.stringify({\r\n                    id: id,\r\n                    blockname: blockname,\r\n                    region: region\r\n                })\r\n            }\r\n        }).done(function(response) {\r\n            response = JSON.parse(response);\r\n            if (!response.error) {\r\n                set_email_shedule_form_values(response, _this, root);\r\n\r\n                root.find(tabs).removeClass(\"active show\");\r\n                root.find(formTab).addClass(\"active show\");\r\n            } else {\r\n                console.log(response);\r\n            }\r\n        }).fail(function(error) {\r\n            console.log(error);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set email shcedule values in form\r\n     * @param {Object} response Response object\r\n     * @param {object} _this click object\r\n     * @param {Object} root Modal root obuject\r\n     */\r\n    function set_email_shedule_form_values(response, _this, root) {\r\n        var esrDurationVal = null;\r\n        var esrTimeVal = null;\r\n\r\n        $.each(response.data, function(idx, val) {\r\n            if (typeof val === 'object') {\r\n                // Set block value name\r\n                root.find(\"#esr-blockname\").val(val.blockname);\r\n                root.find(\"#esr-region\").val(val.region);\r\n            } else if (idx === \"esrduration\") {\r\n                var esrDuration = '[aria-labelledby=\"durationcount\"] .dropdown-item[data-value=\"' + val + '\"]';\r\n                esrDurationVal = val;\r\n                // Trigger click event\r\n                root.find(esrDuration).click();\r\n            } else if (idx === \"esrtime\") {\r\n                esrTimeVal = val;\r\n            } else if (idx === \"esremailenable\") {\r\n                var checkbox = $('input[name=\"' + idx + '\"]');\r\n                if (val) {\r\n                    checkbox.prop(\"checked\", true);\r\n                } else {\r\n                    checkbox.prop(\"checked\", false);\r\n                }\r\n            } else {\r\n                // Set values for input text\r\n                $('[name=\"' + idx + '\"]').val(val);\r\n            }\r\n\r\n        });\r\n\r\n        // Subdropdown click event\r\n        var subSelectedDropdpown = '.dropdown-item[data-value=\"' + esrTimeVal + '\"]';\r\n\r\n        // Show only selected dropdown\r\n        var subDropdown = null;\r\n        switch (esrDurationVal) {\r\n            case \"1\": // Weekly\r\n                subDropdown = $(\".weekly-dropdown\");\r\n                break;\r\n            case \"2\": // Monthly\r\n                subDropdown = $(\".monthly-dropdown\");\r\n                break;\r\n            default: // Daily\r\n                subDropdown = $(\".daily-dropdown\");\r\n        }\r\n\r\n        // Trigger click event\r\n        subDropdown.find(subSelectedDropdpown).click();\r\n    }\r\n\r\n    /**\r\n     * Delete Scheduled email\r\n     * @param {Object} data Data for email\r\n     * @param {object} root Modal root object\r\n     * @param {Object} modal Modal object\r\n     */\r\n    function email_schedule_delete_init(data, root, modal) {\r\n        var id = data.id;\r\n        var blockname = data.block;\r\n        var region = data.region;\r\n        var errorBox = root.find(\".esr-form-error\");\r\n        errorBox.html(loader).show();\r\n\r\n        $.ajax({\r\n            url: v.requestUrl,\r\n            type: v.requestType,\r\n            sesskey: data.sesskey,\r\n            data: {\r\n                action: 'delete_scheduled_email_ajax',\r\n                sesskey: data.sesskey,\r\n                data: JSON.stringify({\r\n                    id: id,\r\n                    blockname: blockname,\r\n                    region: region\r\n                })\r\n            }\r\n        }).done(function(response) {\r\n            if (!response.error) {\r\n                if (emailListTable) {\r\n                    emailListTable.destroy();\r\n                }\r\n                emailListTable = render_all_scheduled_emails(data, modal);\r\n                errorBox.html(deletesuccessmsg);\r\n            } else {\r\n                errorBox.html(deleteerrormsg);\r\n            }\r\n        }).fail(function(error) {\r\n            errorBox.html(deleteerrormsg);\r\n            console.log(error);\r\n        }).always(function() {\r\n            errorBox.delay(3000).fadeOut('slow');\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Change scheduled email status\r\n     * @param {Object} data Data for email\r\n     * @param {object} root Modal root object\r\n     * @param {Object} modal Modal object\r\n     */\r\n    function change_scheduled_email_status_init(data, root, modal) {\r\n        // eslint-disable-next-line no-unused-vars\r\n        modal = null;\r\n        var id = data.id;\r\n        var blockname = data.block;\r\n        var region = data.region;\r\n        var sesskey = data.sesskey;\r\n\r\n        var errorBox = root.find(\".esr-form-error\");\r\n\r\n        $.ajax({\r\n            url: v.requestUrl,\r\n            type: v.requestType,\r\n            data: {\r\n                action: 'change_scheduled_email_status_ajax',\r\n                sesskey: sesskey,\r\n                data: JSON.stringify({\r\n                    id: id,\r\n                    blockname: blockname,\r\n                    region: region\r\n                })\r\n            }\r\n        }).done(function(response) {\r\n            response = JSON.parse(response);\r\n            if (!response.error) {\r\n                errorBox.html(response.successmsg);\r\n                errorBox.show();\r\n                errorBox.delay(3000).fadeOut('slow');\r\n            } else {\r\n                errorBox.html(response.errormsg);\r\n                errorBox.show();\r\n                errorBox.delay(3000).fadeOut('slow');\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Manage schedule emails form initialization\r\n     * @param {Object} data Data for email\r\n     * @param {object} root Modal root object\r\n     * @param {Object} modal Modal object\r\n     */\r\n    function email_schedule_form_init(data, root, modal) {\r\n        // If dropdown selected then update the button text\r\n        root.on('click', dropdowns, function() {\r\n            update_dropdown_btn_text(this);\r\n        });\r\n\r\n        // Select duration for email schedule\r\n        root.on('click', durationSelector, function() {\r\n            duration_dropdown_init(this, root);\r\n        });\r\n\r\n        // Select time for schedule\r\n        root.on('click', timesDropdownLink, function() {\r\n            root.find(timeInput).val($(this).data('value'));\r\n        });\r\n\r\n        // When setting button clicked then\r\n        root.on('click', settingBtn, function() {\r\n            email_schedule_setting_init(this, root);\r\n        });\r\n\r\n        // When delete button clicked then\r\n        root.on('click', deleteBtn, function(e) {\r\n            data.id = $(this).data(\"id\");\r\n\r\n            str.get_strings([\r\n                {\r\n                    key: 'confirmemailremovaltitle',\r\n                    component: 'local_edwiserreports'\r\n                },\r\n                {\r\n                    key: 'confirmemailremovalquestion',\r\n                    component: 'local_edwiserreports'\r\n                },\r\n                {\r\n                    key: 'yes',\r\n                    component: 'moodle'\r\n                },\r\n                {\r\n                    key: 'no',\r\n                    component: 'moodle'\r\n                }\r\n            ]).done(function(s) {\r\n                notif.confirm(s[0], s[1], s[2], s[3], $.proxy(function() {\r\n                    email_schedule_delete_init(data, root, modal);\r\n                }, e.currentTarget));\r\n            });\r\n        });\r\n\r\n        // When toggle switch clicked then\r\n        root.on('change', emailListToggleSwitch, function() {\r\n            data.id = $(this).data(\"id\");\r\n            change_scheduled_email_status_init(data, root, modal);\r\n        });\r\n\r\n        // Send the notification immidiatly\r\n        root.on('click', '[data-action=\"send\"]', function() {\r\n            sendMailToUser(data, this, root);\r\n        });\r\n\r\n        // On save perform operation\r\n        save_schedule_email_init(data, root, modal);\r\n    }\r\n\r\n    /**\r\n     * Send mail to user\r\n     * @param {Object} data Data for email\r\n     * @param {object} _this anchor tag\r\n     * @param {object} root Modal root object\r\n     */\r\n    function sendMailToUser(data, _this, root) {\r\n        var filter = data.filter;\r\n        var cohortid = data.cohortid;\r\n        var block = data.block;\r\n        var errorBox = root.find(\".esr-form-error\");\r\n        errorBox.html('').show();\r\n        if ($(document).find('#cover-spin')) {\r\n            $(\"body\").append(windowLoader);\r\n        }\r\n        $(document).find('#cover-spin').show(0);\r\n\r\n        $.ajax({\r\n            url: M.cfg.wwwroot + \"/local/edwiserreports/download.php?type=email&filter=\"\r\n            + filter + \"&cohortid=\" + cohortid + \"&block=\" + block,\r\n            type: \"POST\",\r\n            data: root.find('form').serialize()\r\n        }).done(function(response) {\r\n            response = $.parseJSON(response);\r\n            if (response.error) {\r\n                errorBox.html('<div class=\"alert alert-danger\"><b>ERROR:</b>' + response.errormsg + '</div>');\r\n            } else {\r\n                errorBox.html('<div class=\"alert alert-success\"><b>Success:</b>' + response.errormsg + '</div>');\r\n            }\r\n        }).fail(function(response) {\r\n            errorBox.html('<div class=\"alert alert-danger\"><b>ERROR:</b>' + response.errormsg + '</div>');\r\n        }).always(function() {\r\n            errorBox.delay(3000).fadeOut('slow');\r\n            $(document).find('#cover-spin').hide();\r\n        });\r\n    }\r\n    return {\r\n        loader: loader\r\n    };\r\n});\r\n"],"file":"common.min.js"}