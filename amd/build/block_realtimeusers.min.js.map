{"version":3,"sources":["block_realtimeusers.js"],"names":["define","$","cfg","common","liveUsersTable","panel","getPanel","panelBody","loader","table","listner","getOnlineUsersData","length","show","ajax","url","requestUrl","type","requestType","dataType","requestDataType","data","action","sesskey","done","response","destroy","hide","DataTable","language","searchPlaceholder","aaSorting","columnDefs","targets","className","orderable","drawCallback","addClass","bInfo","lengthChange","initComplete","usersCount","document","find","append","createRealtimeUsersBlock","fail","error","console","log","always","setTimeout","init","notifyListner"],"mappings":"AAAA,aAGAA,OAAO,CAAC,SAAU,qCAAsC,WAAY,yCAA0C,8CAA+C,SAAUC,EAAGC,EAAKC,GAC7K,IAAIC,EAAiB,KACjBC,EAAQH,EAAII,SAAS,mBACrBC,EAAYL,EAAII,SAAS,kBAAmB,QAC5CE,EAASP,EAAEM,EAAY,YACvBE,EAAQR,EAAEM,EAAY,WACtBG,EAAU,KAed,SAASC,IACHV,EAAEI,GAAOO,QAEXT,EAAOK,OAAOK,KAAK,mBACnBZ,EAAEa,KAAK,CACLC,IAAKb,EAAIc,WACTC,KAAMf,EAAIgB,YACVC,SAAUjB,EAAIkB,gBACdC,KAAM,CACJC,OAAQ,0BACRC,QAAStB,EAAEI,GAAOgB,KAAK,cAExBG,KAAK,SAAUC,IAoBtB,SAAkCJ,GAC5BjB,EACFA,EAAesB,WAEflB,EAAOmB,OACPlB,EAAMI,QAGRT,EAAiBK,EAAMmB,UAAU,CAC/BP,KAAMA,EACNQ,SAAU,CACRC,kBAAmB,eAErBC,UAAW,CAAC,CAAC,EAAG,QAChBC,WAAY,CAAC,CACXC,QAAW,EACXC,UAAa,aACZ,CACDD,QAAW,EACXC,UAAa,eACZ,CACDD,QAAW,EACXC,UAAa,cACbC,WAAa,IAEfC,aAAc,WACZnC,EAAE,sCAAsCoC,SAAS,4BACjDpC,EAAE,sBAAsBoC,SAAS,6BAEnCC,OAAO,EACPC,cAAc,EACdC,aAAc,WACZ,IAAIC,EAAa,oEAAsEpB,EAAKT,OAAS,WACrGX,EAAEyC,UAAUC,KAAK,mBAAmBC,OAAOH,MApD3CI,CAAyBpB,EAASJ,QACjCyB,KAAK,SAAUC,GAChBC,QAAQC,IAAIF,KACXG,OAAO,WACRxC,EAAQ,iBACRyC,WAAWxC,EAAoB,MAE/BR,EAAOK,OAAOmB,KAAK,sBAGrBjB,EAAQ,iBAgDZ,MAAO,CACL0C,KAjFF,SAAcC,GACZ3C,EAAU2C,EACV1C","sourcesContent":["/* eslint-disable no-console */\r\ndefine([\r\n    \"jquery\",\r\n    \"local_edwiserreports/defaultconfig\",\r\n    \"./common\",\r\n    \"local_edwiserreports/jquery.dataTables\",\r\n    \"local_edwiserreports/dataTables.bootstrap4\"\r\n], function($, cfg, common) {\r\n    var liveUsersTable = null;\r\n    var panel = cfg.getPanel(\"#liveusersblock\");\r\n    var panelBody = cfg.getPanel(\"#liveusersblock\", \"body\");\r\n    var loader = $(panelBody + \" .loader\");\r\n    var table = $(panelBody + \" .table\");\r\n    var listner = null;\r\n\r\n    /**\r\n     * Initialize\r\n     * @param {function} notifyListner Callback function\r\n     */\r\n    function init(notifyListner) {\r\n        listner = notifyListner;\r\n\r\n        getOnlineUsersData(); // Call first time\r\n    }\r\n\r\n    /**\r\n     * Get online users data\r\n     */\r\n    function getOnlineUsersData() {\r\n\r\n        if ($(panel).length) {\r\n            // Show loader.\r\n            common.loader.show(\"#liveusersblock\");\r\n\r\n            $.ajax({\r\n                url: cfg.requestUrl,\r\n                type: cfg.requestType,\r\n                dataType: cfg.requestDataType,\r\n                data: {\r\n                    action: 'get_liveusers_data_ajax',\r\n                    sesskey: $(panel).data(\"sesskey\")\r\n                },\r\n            }).done(function(response) {\r\n                createRealtimeUsersBlock(response.data);\r\n            })\r\n            .fail(function(error) {\r\n                console.log(error);\r\n            }).always(function() {\r\n                listner(\"realTimeUsers\");\r\n                setTimeout(getOnlineUsersData, 2 * 60 * 1000);\r\n\r\n                // Hide loader.\r\n                common.loader.hide(\"#liveusersblock\");\r\n\r\n            });\r\n        } else {\r\n            listner(\"realTimeUsers\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create Datatable of the table\r\n     * @param {Object} data Datatable data\r\n     */\r\n    function createRealtimeUsersBlock(data) {\r\n        if (liveUsersTable) {\r\n            liveUsersTable.destroy();\r\n        } else {\r\n            loader.hide();\r\n            table.show();\r\n        }\r\n\r\n        liveUsersTable = table.DataTable({\r\n            data: data,\r\n            language: {\r\n                searchPlaceholder: \"Search User\"\r\n            },\r\n            aaSorting: [[1, 'asc']],\r\n            columnDefs: [\r\n                {\r\n                    \"targets\": 0,\r\n                    \"className\": \"text-left\"\r\n                },\r\n                {\r\n                    \"targets\": 1,\r\n                    \"className\": \"text-center\"\r\n                },\r\n                {\r\n                    \"targets\": 2,\r\n                    \"className\": \"text-center\",\r\n                    \"orderable\": false\r\n                }\r\n            ],\r\n            drawCallback: function() {\r\n                $('.dataTables_paginate > .pagination').addClass('pagination-sm pull-right');\r\n                $('.dataTables_filter').addClass('pagination-sm pull-right');\r\n            },\r\n            bInfo: false,\r\n            lengthChange: false,\r\n            initComplete: function() {\r\n                var usersCount = '<small class=\"ml-auto my-auto font-weight-bold\">LoggedIn Users : ' + data.length + '</small>';\r\n                $(document).find(\".rtblock-filter\").append(usersCount);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Must return the init function\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"file":"block_realtimeusers.min.js"}